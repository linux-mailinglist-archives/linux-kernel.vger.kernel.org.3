Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 88EDF5A2B1F
	for <lists+linux-kernel@lfdr.de>; Fri, 26 Aug 2022 17:26:01 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1344658AbiHZPZc (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Fri, 26 Aug 2022 11:25:32 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:38482 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1344484AbiHZPY7 (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 26 Aug 2022 11:24:59 -0400
Received: from smtp-out2.suse.de (smtp-out2.suse.de [IPv6:2001:67c:2178:6::1d])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 0CB49A18E
        for <linux-kernel@vger.kernel.org>; Fri, 26 Aug 2022 08:20:11 -0700 (PDT)
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de [192.168.254.74])
        (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
         key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
        (No client certificate requested)
        by smtp-out2.suse.de (Postfix) with ESMTPS id 743CF1F949;
        Fri, 26 Aug 2022 15:20:09 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.de; s=susede2_rsa;
        t=1661527209; h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
         mime-version:mime-version:content-type:content-type:
         in-reply-to:in-reply-to:references:references;
        bh=97iE3p86LmL5nUt7jtSPzfO+8BqMwNIDg5V6WRooFvo=;
        b=Fvy/YmQ++k2snw5ygCkZsCkSBP3pMOpZ0kHAWTnhKDLty7Vh6e3U848l3kumjv5agbeQl+
        E+45C2hWkyRllWYaX1VdkHAc6+BmUaJ5gPg7ZoHi9eAL/LYNlk3EievHbV2sBiqgvAiozH
        O3flP2dcxE4IcHiJv2uOaVarlc62O5s=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.de;
        s=susede2_ed25519; t=1661527209;
        h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
         mime-version:mime-version:content-type:content-type:
         in-reply-to:in-reply-to:references:references;
        bh=97iE3p86LmL5nUt7jtSPzfO+8BqMwNIDg5V6WRooFvo=;
        b=E3klih5m/Ngy7425d9QqRZ7n3kql1r8/nYNwA7Dcn0lO8/mk/VYG2DhOczxseDad7BCr6o
        Yeu70xLSO75fR2Bw==
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de [192.168.254.74])
        (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
         key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
        (No client certificate requested)
        by imap2.suse-dmz.suse.de (Postfix) with ESMTPS id 4789813A7E;
        Fri, 26 Aug 2022 15:20:09 +0000 (UTC)
Received: from dovecot-director2.suse.de ([192.168.254.65])
        by imap2.suse-dmz.suse.de with ESMTPSA
        id NAODEKnkCGPMWQAAMHmgww
        (envelope-from <tiwai@suse.de>); Fri, 26 Aug 2022 15:20:09 +0000
Date:   Fri, 26 Aug 2022 17:20:08 +0200
Message-ID: <87r113jal3.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     Lennert Van Alboom <lennert@vanalboom.org>
Cc:     Jaroslav Kysela <perex@perex.cz>, Takashi Iwai <tiwai@suse.com>,
        "alsa-devel@alsa-project.org" <alsa-devel@alsa-project.org>,
        "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>,
        "ls.yoyo.m@gmail.com" <ls.yoyo.m@gmail.com>
Subject: Re: [PATCH] USB DAC broken since commit bf6313a0ff766925462e97b4e733d5952de02367 (5.10.0-rc5)
In-Reply-To: <m8XpaeWJS23wth20p7EgE-Cxwi-5ZwWl0InTEc-wsDGOwh8Nw5RViGXqM_yP92eOmX0Kxfs2hcizPwZaEce80T3OH1rLQ3ph555M1iTCmFc=@vanalboom.org>
References: <T3VPXtCc4uFws9Gfh2RjX6OdwM1RqfC6VqQr--_LMDyB2x5N3p9_q6AtPna17IXhHwBtcJVdXuS80ZZSCMjh_BafIbnzJPhbrkmhmWS6DlI=@vanalboom.org>
        <874jy0mvwv.wl-tiwai@suse.de>
        <JGbq2exwKdQ4T8GQCI5YWzGredZVbYtBOxlnBN0ROtba40PvCdEKfz2mKzClqejgZMck374nGQyEIwzjiBi6sKYYNnJgKp26n1-_j6GT3hw=@vanalboom.org>
        <87bks7leun.wl-tiwai@suse.de>
        <m8XpaeWJS23wth20p7EgE-Cxwi-5ZwWl0InTEc-wsDGOwh8Nw5RViGXqM_yP92eOmX0Kxfs2hcizPwZaEce80T3OH1rLQ3ph555M1iTCmFc=@vanalboom.org>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) Emacs/27.2 Mule/6.0
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
        DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,SPF_HELO_NONE,SPF_PASS,
        T_SCC_BODY_TEXT_LINE autolearn=ham autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Fri, 26 Aug 2022 11:07:55 +0200,
Lennert Van Alboom wrote:
> 
> ------- Original Message -------
> On Friday, August 26th, 2022 at 08:05, Takashi Iwai <tiwai@suse.de> wrote:
> > 
> 
> > This option is passed per card instance, as the driver may hold
> > multiple cards. Check your /proc/asound/cards. The first argument of
> > quirk_flags is applied to the first USB-audio card, the second to the
> > second USB audio device, and so on.
> > 
> 
> > At best, give alsa-info.sh output before and after applying the
> > quirk. Run the script with --no-upload option and attach the
> > outputs.
> > 
> 
> > And, as a reference, you can see the existing quirk tables in
> > sound/usb/quirks.c.
> > 
> 
> > 
> 
> > Takashi
> 
> 
> Not sure why it failed before (didn't look further then, so possibly PEBKAC) but as you suggested, this works now (tested on debian's 5.19 kernel):
> 
> # modprobe snd_usb_audio vid=0x2522 pid=0x0007 quirk_flags=0x10000
> 
> 
> Confirmed that setting a quirk_alias also works: 
> 
> 
> # grep -A 1 "0x054c, 0x0b8c" linux/sound/usb/quirks.c 
> 
> 	DEVICE_FLG(0x054c, 0x0b8c, /* Sony WALKMAN NW-A45 DAC */
> 		   QUIRK_FLAG_SET_IFACE_FIRST),
> # modprobe snd_usb_audio quirk_alias=25220007:054c0b8c
> 
> 
> I've added a patch for quirks.c to make this default behaviour for
> this device.

Good to hear.  Will you submit the fix patch for the merge, or shall I
do it in my side?

> Looking at the Arch bug report at https://bugs.archlinux.org/task/70636, it's likely similar behaviour may be needed for pid=0009 (LH Labs Geek Pulse X 1V5) but I have no way of testing this. Added the reporter in CC.

It's likely OK to apply the same quirk, but it's certainly safer to
hear the test result, of course.


thanks,

Takashi
