Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 8F0D35AC54C
	for <lists+linux-kernel@lfdr.de>; Sun,  4 Sep 2022 18:11:09 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S234596AbiIDQKr (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Sun, 4 Sep 2022 12:10:47 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:40246 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S234489AbiIDQKo (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 4 Sep 2022 12:10:44 -0400
Received: from ams.source.kernel.org (ams.source.kernel.org [IPv6:2604:1380:4601:e00::1])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 8307E2ED63
        for <linux-kernel@vger.kernel.org>; Sun,  4 Sep 2022 09:10:42 -0700 (PDT)
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by ams.source.kernel.org (Postfix) with ESMTPS id 0876BB80D70
        for <linux-kernel@vger.kernel.org>; Sun,  4 Sep 2022 16:10:41 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id A3791C433D6;
        Sun,  4 Sep 2022 16:10:39 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=k20201202; t=1662307839;
        bh=Om6/hIL+0XN2aqKtuH8An6Dj/YydVxAyOKwj78wK3wM=;
        h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
        b=XjNo+HzbD17U+BT6DCtAQao0RF3qT2443tfSEub2zvUwRKWPwgupnBUkye1fhzgaz
         HfPQc8SHLDHhxO7kltNZuZnN7uNWZSx+rG8uyf5G6XiehwEskr3lH/emeJRiXShEMB
         N8tiPrnp7T3epssKyCc4TKWrNboI4W4neC6aSc7VemLBa9s+f8z8RDhQ3Ird7aJ3GL
         pGO4U4KgM2jnwdKFnOTQ3bRhyTO/VZA2tZIRsoPDvK+TdUd95SUCPUSWU0DbBlBJ9r
         9UybP0DAKASjNBHm9aBY+9VMjFLs+uh3j9KC/dr7hOqeMpl+ox5Gw2SMCeZIbaVUqh
         iCSZMfx8M+9kA==
Received: from sofa.misterjones.org ([185.219.108.64] helo=why.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.95)
        (envelope-from <maz@kernel.org>)
        id 1oUsCj-007uJo-CE;
        Sun, 04 Sep 2022 17:10:37 +0100
Date:   Sun, 04 Sep 2022 17:10:36 +0100
Message-ID: <87v8q3unlv.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     "Russell King (Oracle)" <linux@armlinux.org.uk>
Cc:     Arnd Bergmann <arnd@kernel.org>, linux-kernel@vger.kernel.org,
        linux-arm-kernel@lists.infradead.org,
        Arnd Bergmann <arnd@arndb.de>, Christoph Hellwig <hch@lst.de>,
        Linus Walleij <linus.walleij@linaro.org>
Subject: Re: [PATCH 0/4] ARM: footbridge: cleanups
In-Reply-To: <YxSVhsHVsqZiAUS0@shell.armlinux.org.uk>
References: <20220818211550.3272321-1-arnd@kernel.org>
        <87wnajuzyj.wl-maz@kernel.org>
        <YxSVhsHVsqZiAUS0@shell.armlinux.org.uk>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/27.1
 (x86_64-pc-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: linux@armlinux.org.uk, arnd@kernel.org, linux-kernel@vger.kernel.org, linux-arm-kernel@lists.infradead.org, arnd@arndb.de, hch@lst.de, linus.walleij@linaro.org
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
X-Spam-Status: No, score=-7.1 required=5.0 tests=BAYES_00,DKIMWL_WL_HIGH,
        DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_HI,
        SPF_HELO_NONE,SPF_PASS,T_SCC_BODY_TEXT_LINE autolearn=ham
        autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Sun, 04 Sep 2022 13:09:42 +0100,
"Russell King (Oracle)" <linux@armlinux.org.uk> wrote:
> 
> On Sun, Sep 04, 2022 at 12:43:48PM +0100, Marc Zyngier wrote:
> > On Thu, 18 Aug 2022 22:15:46 +0100,
> > Arnd Bergmann <arnd@kernel.org> wrote:
> > > 
> > > From: Arnd Bergmann <arnd@arndb.de>
> > > 
> > > I had an older patch to remove the addin mode for footbridge,
> > > which nobody is using any more, and I found a few other small
> > > cleanups that are worth doing here.
> > > 
> > > Footbridge is now the only platform with a custom __virt_to_bus()
> > > for ISA DMA, and a custom phys_to_dma() for PCI devices. Both
> > > just add a fixed offset, so there is probably a better way
> > > of doing the same without a custom helper function.
> > > 
> > >      Arnd
> > > 
> > > Arnd Bergmann (4):
> > >   ARM: footbridge: remove addin mode
> > >   ARM: footbridge: remove leftover from personal-server
> > >   ARM: footbridge: move isa-dma support into footbridge
> > >   ARM: footbridge: limit CONFIG_ISA to CATS
> > > 
> > >  arch/arm/Kconfig                              |  5 --
> > >  arch/arm/include/asm/hardware/dec21285.h      | 13 ----
> > >  arch/arm/kernel/Makefile                      |  1 -
> > >  arch/arm/mach-footbridge/Kconfig              | 30 +-------
> > >  arch/arm/mach-footbridge/Makefile             |  5 +-
> > >  arch/arm/mach-footbridge/common.c             | 73 ++-----------------
> > >  arch/arm/mach-footbridge/dc21285.c            | 61 +++++-----------
> > >  .../arm/{kernel => mach-footbridge}/dma-isa.c |  7 +-
> > >  arch/arm/mach-footbridge/dma.c                | 58 ---------------
> > >  .../mach-footbridge/include/mach/isa-dma.h    | 14 +---
> > >  .../arm/mach-footbridge/include/mach/memory.h | 22 ------
> > >  arch/arm/mach-footbridge/isa.c                | 14 ++--
> > >  drivers/tty/serial/21285.c                    |  3 -
> > >  13 files changed, 42 insertions(+), 264 deletions(-)
> > >  rename arch/arm/{kernel => mach-footbridge}/dma-isa.c (98%)
> > >  delete mode 100644 arch/arm/mach-footbridge/dma.c
> > > 
> > > -- 
> > > 2.29.2
> > > 
> > > Cc: Russell King <linux@armlinux.org.uk>
> > > Cc: Christoph Hellwig <hch@lst.de>
> > > Cc: Linus Walleij <linus.walleij@linaro.org>
> > > Cc: Marc Zyngier <maz@kernel.org>
> > 
> > I finally managed to give this a go on my netwinder using v2 of patch
> > 5/4 (!), and the box booted nicely.
> > 
> > Note that apart from the serial console, everything I'm using on this
> > box is PCI (I tried to enable sound and failed, probably because I
> > can't select CONFIG_ISA anymore on this machine).
> 
> That tends to mean, therefore, that the statement "CONFIG_ISA is for
> add-in cards" is wrong, because it's caused a user-visible regression
> by killing sound support on Netwinders!

To some extent, yes. Adding this allows me to peek at some of the ISA
soundcards:

diff --git a/arch/arm/mach-footbridge/Kconfig b/arch/arm/mach-footbridge/Kconfig
index f452663576d1..f4c4222fa7c0 100644
--- a/arch/arm/mach-footbridge/Kconfig
+++ b/arch/arm/mach-footbridge/Kconfig
@@ -31,6 +31,7 @@ config ARCH_NETWINDER
 	select CLKEVT_I8253
 	select CLKSRC_I8253
 	select FORCE_PCI
+	select ISA
 	help
 	  Say Y here if you intend to run this kernel on the Rebel.COM
 	  NetWinder.  Information about this machine can be found at:

However, the Waveartist driver has gone the way of the dodo (together
with the rest of the OSS support in 4.15), and it isn't obvious to me
whether one of the several SoundBlaster drivers is appropriate on this
machine.

I also cannot say I deeply care, to be honest.

	M.

-- 
Without deviation from the norm, progress is not possible.
