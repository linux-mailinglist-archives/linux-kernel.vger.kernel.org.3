Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 5BAB9546530
	for <lists+linux-kernel@lfdr.de>; Fri, 10 Jun 2022 13:10:40 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1348806AbiFJLJr (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Fri, 10 Jun 2022 07:09:47 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:59588 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1348086AbiFJLJX (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 10 Jun 2022 07:09:23 -0400
Received: from mout.gmx.net (mout.gmx.net [212.227.15.15])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id E7F39146416;
        Fri, 10 Jun 2022 04:09:19 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=gmx.net;
        s=badeba3b8450; t=1654859345;
        bh=p955SyiSzBhWDKZyzjCb0RQrzzzHMlRchzhBPwUvL9c=;
        h=X-UI-Sender-Class:From:To:Cc:Subject:Date:In-Reply-To:References;
        b=Uedbp9PiIwiSA/4jX7EyXN7wrD93q8GdX6vyvHoIJEJWaPkbdSsZDql9w2L8lKRSX
         rYdc/HGsra9oM4x5he6ITRilDoRuGkNT4mev7vmJIE0+1oPipXusGoeDsJHcEbgfx+
         P1200JSGOBOgYZQFc1bDNY266ZrE1t9mplWertW8=
X-UI-Sender-Class: 01bb95c1-4bf8-414a-932a-4f6e2808ef9c
Received: from Venus.fritz.box ([46.223.3.165]) by mail.gmx.net (mrgmx004
 [212.227.17.190]) with ESMTPSA (Nemesis) id 1N3bWr-1nYZHe0aHr-010cAT; Fri, 10
 Jun 2022 13:09:05 +0200
From:   LinoSanfilippo@gmx.de
To:     peterhuewe@gmx.de, jarkko@kernel.org, jgg@ziepe.ca
Cc:     stefanb@linux.vnet.ibm.com, linux@mniewoehner.de,
        linux-integrity@vger.kernel.org, linux-kernel@vger.kernel.org,
        l.sanfilippo@kunbus.com, LinoSanfilippo@gmx.de, lukas@wunner.de,
        p.rosenberger@kunbus.com
Subject: [PATCH v5 05/10] tpm, tpm_tis: Store result of interrupt capability query
Date:   Fri, 10 Jun 2022 13:08:41 +0200
Message-Id: <20220610110846.8307-6-LinoSanfilippo@gmx.de>
X-Mailer: git-send-email 2.36.1
In-Reply-To: <20220610110846.8307-1-LinoSanfilippo@gmx.de>
References: <20220610110846.8307-1-LinoSanfilippo@gmx.de>
MIME-Version: 1.0
Content-Transfer-Encoding: base64
X-Provags-ID: V03:K1:BY2VZJgYcZdy5zIhVGCICkZ8eePhQQc4vLdN+/MI383CBnP2/uF
 VIFiiFQuv6pKsETm1HfMeLdoIezpnagNlHViF3AXuwdsrDaV/sSkdKP1hYcg24IX0ZjlXux
 FgvQH94dcrFKCKMqO8UngfCJOmirlXt7yrEFhN9eKBV8zmeVCdoMLg+hxXJdHvyIawLl19+
 qGrg3lse45tsWYsVgc2ww==
X-UI-Out-Filterresults: notjunk:1;V03:K0:+SrIRyz0C/w=:sNiyQ6W9TEhnIIqWjbBPLZ
 UJApolDV3vfx4d5UQxjaN89QrRWSpPZiuye9/AqtUlK5kkVrmmWfiX0HGD1E6XBFHnQab/ivA
 Fs5nonakShpW3omY7YidNzeY+g1UL84SmTyF6Q2s2PE3uflHRV2u6yZqxgGTo48gc6JkykO8h
 CogY6l2nTWi9YcPJyqqaBkBoYtUsLiKRgtbFuS3CPLjgkAtK4MCZXjc2ckSokLCAkBuBg83ZU
 aA9gnI5qeS//jsiS6qn2Od0gG2v5AgiABVhExIWirpvtb/xAK22tQKCcmHASJ8oh0bRRwfsuR
 2+Pf1d32aQUohqVDB8bLw57snN2401gkNHycNLdGIwT2qWOsajSHja4jRVH1IPjLH80u83E9l
 cT+gyBQJCHS7nxRboKRvBeWJywkR/PkBS36bIQZmbAJJdAkhaIhnzSLis5CeeVP1VjW5rinNU
 B8i4371yY19LPCAYQ5eBGVPPHRiCFai8TmzFlIcNebRylPvzORXa091//ZAWOCHu3QaKXYw4x
 FQq3tLqzKGW1UvSqQvUz7IaY0Qm1Wj7kueglOwGIUC6v8ZjGj86SgR6I4xihE+SfulDsjYUL4
 k4RR/urEmwd6pbmY/QUbbLLkeTGV6MD2+AFdwgurq1+pFdU5BMLTQqSoGJAcTRljiAx0HZAWI
 WinTPIfYVpYQdXBmIXp6L1jnjv2kp3KVLKf+f+Ka7X2hCxWrC8PQpzyUqVQsgCFga+dqMuAhw
 nigfniTJX/MTPTZOnIf6WW2Wz2t1H2USTN2Hz4livJcQLkZ7CrjNeRoq1wxeDYpy6oIPVT+Mj
 iNzVcHUCiar1NukMZWdjFOE6owErYbMLQOH375RFVMlu0Aeol0bUYi9P69zDL0l0R/sSBjNIc
 22o2Bg7dEiDoP6U+lqmYJddQwCMKnDwAF+3YNLUu+WrjJyYhMVzxqJGm0kHATRXIEdyfitrvF
 15Htseh0uxdMu4EW2PK7ULLY9rUVJ+FdwIl3JVR8a0MlKQgRrZnk5xQ0Sh9imz11czebPvdcX
 mBliLN50/yuS733hj8/H2KERLaJ6IBi1KHHYURP1xDmx+pxA1e1DXqskm1he8qNYHkB23QpQL
 +C45WAH9Tz24l8aMxrFEIYY0dJ1/I/ZG8fT6B+S+R+bPUdVEdXWvsZNwg==
X-Spam-Status: No, score=-0.9 required=5.0 tests=BAYES_00,DKIM_SIGNED,
        DKIM_VALID,FREEMAIL_FROM,MIME_BASE64_TEXT,RCVD_IN_DNSWL_LOW,
        RCVD_IN_MSPIKE_H2,SPF_HELO_NONE,SPF_PASS,T_SCC_BODY_TEXT_LINE
        autolearn=ham autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

RnJvbTogTGlubyBTYW5maWxpcHBvIDxsLnNhbmZpbGlwcG9Aa3VuYnVzLmNvbT4KCkFjY29yZGlu
ZyB0byB0aGUgVFBNIEludGVyZmFjZSBTcGVjaWZpY2F0aW9uIChUSVMpIHN1cHBvcnQgZm9yICJz
dHNWYWxpZCIKYW5kICJjb21tYW5kUmVhZHkiIGludGVycnVwdHMgaXMgb25seSBvcHRpb25hbC4K
VGhpcyBoYXMgdG8gYmUgdGFrZW4gaW50byBhY2NvdW50IHdoZW4gaGFuZGxpbmcgdGhlIGludGVy
cnVwdHMgaW4gZnVuY3Rpb25zCmxpa2Ugd2FpdF9mb3JfdHBtX3N0YXQoKS4gU28gcXVlcnkgdGhl
IHNldCBvZiBzdXBwb3J0ZWQgaW50ZXJydXB0cyBhbmQKc3RvcmUgaXQgaW4gYSBnbG9iYWwgdmFy
aWFibGUgc28gdGhhdCBpdCBjYW4gYmUgYWNjZXNzZWQgbGF0ZXIuCgpTaWduZWQtb2ZmLWJ5OiBM
aW5vIFNhbmZpbGlwcG8gPGwuc2FuZmlsaXBwb0BrdW5idXMuY29tPgotLS0KIGRyaXZlcnMvY2hh
ci90cG0vdHBtX3Rpc19jb3JlLmMgfCA3MyArKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0t
LS0KIGRyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmggfCAgMSArCiAyIGZpbGVzIGNoYW5n
ZWQsIDM4IGluc2VydGlvbnMoKyksIDM2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmMgYi9kcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNfY29y
ZS5jCmluZGV4IDcxODUyNWZjYWRjMC4uMmYwM2ZlZmExNzA2IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2NoYXIvdHBtL3RwbV90aXNfY29yZS5jCisrKyBiL2RyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19j
b3JlLmMKQEAgLTEwMDcsOCArMTAwNywzOSBAQCBpbnQgdHBtX3Rpc19jb3JlX2luaXQoc3RydWN0
IGRldmljZSAqZGV2LCBzdHJ1Y3QgdHBtX3Rpc19kYXRhICpwcml2LCBpbnQgaXJxLAogCWlmIChy
YyA8IDApCiAJCWdvdG8gb3V0X2VycjsKIAotCWludG1hc2sgfD0gVFBNX0lOVEZfQ01EX1JFQURZ
X0lOVCB8IFRQTV9JTlRGX0xPQ0FMSVRZX0NIQU5HRV9JTlQgfAotCQkgICBUUE1fSU5URl9EQVRB
X0FWQUlMX0lOVCB8IFRQTV9JTlRGX1NUU19WQUxJRF9JTlQ7CisJLyogRmlndXJlIG91dCB0aGUg
Y2FwYWJpbGl0aWVzICovCisJcmMgPSB0cG1fdGlzX3JlYWQzMihwcml2LCBUUE1fSU5URl9DQVBT
KHByaXYtPmxvY2FsaXR5KSwgJmludGZjYXBzKTsKKwlpZiAocmMgPCAwKQorCQlnb3RvIG91dF9l
cnI7CisKKwlkZXZfZGJnKGRldiwgIlRQTSBpbnRlcmZhY2UgY2FwYWJpbGl0aWVzICgweCV4KTpc
biIsCisJCWludGZjYXBzKTsKKwlpZiAoaW50ZmNhcHMgJiBUUE1fSU5URl9CVVJTVF9DT1VOVF9T
VEFUSUMpCisJCWRldl9kYmcoZGV2LCAiXHRCdXJzdCBDb3VudCBTdGF0aWNcbiIpOworCWlmIChp
bnRmY2FwcyAmIFRQTV9JTlRGX0NNRF9SRUFEWV9JTlQpIHsKKwkJaW50bWFzayB8PSBUUE1fSU5U
Rl9DTURfUkVBRFlfSU5UOworCQlkZXZfZGJnKGRldiwgIlx0Q29tbWFuZCBSZWFkeSBJbnQgU3Vw
cG9ydFxuIik7CisJfQorCWlmIChpbnRmY2FwcyAmIFRQTV9JTlRGX0lOVF9FREdFX0ZBTExJTkcp
CisJCWRldl9kYmcoZGV2LCAiXHRJbnRlcnJ1cHQgRWRnZSBGYWxsaW5nXG4iKTsKKwlpZiAoaW50
ZmNhcHMgJiBUUE1fSU5URl9JTlRfRURHRV9SSVNJTkcpCisJCWRldl9kYmcoZGV2LCAiXHRJbnRl
cnJ1cHQgRWRnZSBSaXNpbmdcbiIpOworCWlmIChpbnRmY2FwcyAmIFRQTV9JTlRGX0lOVF9MRVZF
TF9MT1cpCisJCWRldl9kYmcoZGV2LCAiXHRJbnRlcnJ1cHQgTGV2ZWwgTG93XG4iKTsKKwlpZiAo
aW50ZmNhcHMgJiBUUE1fSU5URl9JTlRfTEVWRUxfSElHSCkKKwkJZGV2X2RiZyhkZXYsICJcdElu
dGVycnVwdCBMZXZlbCBIaWdoXG4iKTsKKwlpZiAoaW50ZmNhcHMgJiBUUE1fSU5URl9MT0NBTElU
WV9DSEFOR0VfSU5UKQorCQlpbnRtYXNrIHw9IFRQTV9JTlRGX0xPQ0FMSVRZX0NIQU5HRV9JTlQ7
CisJCWRldl9kYmcoZGV2LCAiXHRMb2NhbGl0eSBDaGFuZ2UgSW50IFN1cHBvcnRcbiIpOworCWlm
IChpbnRmY2FwcyAmIFRQTV9JTlRGX1NUU19WQUxJRF9JTlQpIHsKKwkJaW50bWFzayB8PSBUUE1f
SU5URl9TVFNfVkFMSURfSU5UOworCQlkZXZfZGJnKGRldiwgIlx0U3RzIFZhbGlkIEludCBTdXBw
b3J0XG4iKTsKKwl9CisJaWYgKGludGZjYXBzICYgVFBNX0lOVEZfREFUQV9BVkFJTF9JTlQpIHsK
KwkJaW50bWFzayB8PSBUUE1fSU5URl9EQVRBX0FWQUlMX0lOVDsKKwkJZGV2X2RiZyhkZXYsICJc
dERhdGEgQXZhaWwgSW50IFN1cHBvcnRcbiIpOworCX0KKwogCWludG1hc2sgJj0gflRQTV9HTE9C
QUxfSU5UX0VOQUJMRTsKIAogCXJjID0gcmVxdWVzdF9sb2NhbGl0eShjaGlwLCAwKTsKQEAgLTEw
NDIsMzIgKzEwNzMsNiBAQCBpbnQgdHBtX3Rpc19jb3JlX2luaXQoc3RydWN0IGRldmljZSAqZGV2
LCBzdHJ1Y3QgdHBtX3Rpc19kYXRhICpwcml2LCBpbnQgaXJxLAogCQlnb3RvIG91dF9lcnI7CiAJ
fQogCi0JLyogRmlndXJlIG91dCB0aGUgY2FwYWJpbGl0aWVzICovCi0JcmMgPSB0cG1fdGlzX3Jl
YWQzMihwcml2LCBUUE1fSU5URl9DQVBTKHByaXYtPmxvY2FsaXR5KSwgJmludGZjYXBzKTsKLQlp
ZiAocmMgPCAwKQotCQlnb3RvIG91dF9lcnI7Ci0KLQlkZXZfZGJnKGRldiwgIlRQTSBpbnRlcmZh
Y2UgY2FwYWJpbGl0aWVzICgweCV4KTpcbiIsCi0JCWludGZjYXBzKTsKLQlpZiAoaW50ZmNhcHMg
JiBUUE1fSU5URl9CVVJTVF9DT1VOVF9TVEFUSUMpCi0JCWRldl9kYmcoZGV2LCAiXHRCdXJzdCBD
b3VudCBTdGF0aWNcbiIpOwotCWlmIChpbnRmY2FwcyAmIFRQTV9JTlRGX0NNRF9SRUFEWV9JTlQp
Ci0JCWRldl9kYmcoZGV2LCAiXHRDb21tYW5kIFJlYWR5IEludCBTdXBwb3J0XG4iKTsKLQlpZiAo
aW50ZmNhcHMgJiBUUE1fSU5URl9JTlRfRURHRV9GQUxMSU5HKQotCQlkZXZfZGJnKGRldiwgIlx0
SW50ZXJydXB0IEVkZ2UgRmFsbGluZ1xuIik7Ci0JaWYgKGludGZjYXBzICYgVFBNX0lOVEZfSU5U
X0VER0VfUklTSU5HKQotCQlkZXZfZGJnKGRldiwgIlx0SW50ZXJydXB0IEVkZ2UgUmlzaW5nXG4i
KTsKLQlpZiAoaW50ZmNhcHMgJiBUUE1fSU5URl9JTlRfTEVWRUxfTE9XKQotCQlkZXZfZGJnKGRl
diwgIlx0SW50ZXJydXB0IExldmVsIExvd1xuIik7Ci0JaWYgKGludGZjYXBzICYgVFBNX0lOVEZf
SU5UX0xFVkVMX0hJR0gpCi0JCWRldl9kYmcoZGV2LCAiXHRJbnRlcnJ1cHQgTGV2ZWwgSGlnaFxu
Iik7Ci0JaWYgKGludGZjYXBzICYgVFBNX0lOVEZfTE9DQUxJVFlfQ0hBTkdFX0lOVCkKLQkJZGV2
X2RiZyhkZXYsICJcdExvY2FsaXR5IENoYW5nZSBJbnQgU3VwcG9ydFxuIik7Ci0JaWYgKGludGZj
YXBzICYgVFBNX0lOVEZfU1RTX1ZBTElEX0lOVCkKLQkJZGV2X2RiZyhkZXYsICJcdFN0cyBWYWxp
ZCBJbnQgU3VwcG9ydFxuIik7Ci0JaWYgKGludGZjYXBzICYgVFBNX0lOVEZfREFUQV9BVkFJTF9J
TlQpCi0JCWRldl9kYmcoZGV2LCAiXHREYXRhIEF2YWlsIEludCBTdXBwb3J0XG4iKTsKLQogCS8q
IElOVEVSUlVQVCBTZXR1cCAqLwogCWluaXRfd2FpdHF1ZXVlX2hlYWQoJnByaXYtPnJlYWRfcXVl
dWUpOwogCWluaXRfd2FpdHF1ZXVlX2hlYWQoJnByaXYtPmludF9xdWV1ZSk7CkBAIC0xMDk4LDcg
KzExMDMsOSBAQCBpbnQgdHBtX3Rpc19jb3JlX2luaXQoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1
Y3QgdHBtX3Rpc19kYXRhICpwcml2LCBpbnQgaXJxLAogCQllbHNlCiAJCQl0cG1fdGlzX3Byb2Jl
X2lycShjaGlwLCBpbnRtYXNrKTsKIAotCQlpZiAoIShjaGlwLT5mbGFncyAmIFRQTV9DSElQX0ZM
QUdfSVJRKSkgeworCQlpZiAoY2hpcC0+ZmxhZ3MgJiBUUE1fQ0hJUF9GTEFHX0lSUSkgeworCQkJ
cHJpdi0+aXJxc19pbl91c2UgPSBpbnRtYXNrOworCQl9IGVsc2UgewogCQkJZGV2X2VycigmY2hp
cC0+ZGV2LCBGV19CVUcKIAkJCQkJIlRQTSBpbnRlcnJ1cHQgbm90IHdvcmtpbmcsIHBvbGxpbmcg
aW5zdGVhZFxuIik7CiAKQEAgLTExNDUsMTMgKzExNTIsNyBAQCBzdGF0aWMgdm9pZCB0cG1fdGlz
X3JlZW5hYmxlX2ludGVycnVwdHMoc3RydWN0IHRwbV9jaGlwICpjaGlwKQogCWlmIChyYyA8IDAp
CiAJCWdvdG8gb3V0OwogCi0JcmMgPSB0cG1fdGlzX3JlYWQzMihwcml2LCBUUE1fSU5UX0VOQUJM
RShwcml2LT5sb2NhbGl0eSksICZpbnRtYXNrKTsKLQlpZiAocmMgPCAwKQotCQlnb3RvIG91dDsK
LQotCWludG1hc2sgfD0gVFBNX0lOVEZfQ01EX1JFQURZX0lOVAotCSAgICB8IFRQTV9JTlRGX0xP
Q0FMSVRZX0NIQU5HRV9JTlQgfCBUUE1fSU5URl9EQVRBX0FWQUlMX0lOVAotCSAgICB8IFRQTV9J
TlRGX1NUU19WQUxJRF9JTlQgfCBUUE1fR0xPQkFMX0lOVF9FTkFCTEU7CisJaW50bWFzayA9IHBy
aXYtPmlycXNfaW5fdXNlIHwgVFBNX0dMT0JBTF9JTlRfRU5BQkxFOwogCiAJdHBtX3Rpc193cml0
ZTMyKHByaXYsIFRQTV9JTlRfRU5BQkxFKHByaXYtPmxvY2FsaXR5KSwgaW50bWFzayk7CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmggYi9kcml2ZXJzL2NoYXIv
dHBtL3RwbV90aXNfY29yZS5oCmluZGV4IDBmMjlkMGI2OGMzZS4uOGUwMmZhYTQwNzlkIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNfY29yZS5oCisrKyBiL2RyaXZlcnMvY2hh
ci90cG0vdHBtX3Rpc19jb3JlLmgKQEAgLTk2LDYgKzk2LDcgQEAgc3RydWN0IHRwbV90aXNfZGF0
YSB7CiAJdTE2IG1hbnVmYWN0dXJlcl9pZDsKIAlpbnQgbG9jYWxpdHk7CiAJaW50IGlycTsKKwl1
bnNpZ25lZCBpbnQgaXJxc19pbl91c2U7CiAJdW5zaWduZWQgbG9uZyBpcnF0ZXN0X2ZsYWdzOwog
CXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAJdm9pZCBfX2lvbWVtICppbGJfYmFzZV9hZGRyOwotLSAK
Mi4zNi4xCgo=
