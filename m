Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id A55E25533B7
	for <lists+linux-kernel@lfdr.de>; Tue, 21 Jun 2022 15:37:23 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S232681AbiFUNex (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Tue, 21 Jun 2022 09:34:53 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:55582 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1351479AbiFUNbC (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Tue, 21 Jun 2022 09:31:02 -0400
Received: from mout.gmx.net (mout.gmx.net [212.227.15.19])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 695B82AE1A;
        Tue, 21 Jun 2022 06:25:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=gmx.net;
        s=badeba3b8450; t=1655817938;
        bh=UqrXeJeyucbWKhNmptMWsyd6uHrhoNhsf8+CRRXH2jk=;
        h=X-UI-Sender-Class:From:To:Cc:Subject:Date:In-Reply-To:References;
        b=Rp4vy+NYBHbZuabQdJKfPHAGgjpz3NRRkDylO+Gj6wfCOSVmWwhYjOao90t8zXY6f
         5nYAbnpViF4V/7knSmVQjgEZfpgmPSa3KzyQF0yekdQpQJBbdE5KgVEcbpg/tIlxDo
         XHT+l6C+pUasnhksqIYYwennOqFsts2/OoFKrJ2I=
X-UI-Sender-Class: 01bb95c1-4bf8-414a-932a-4f6e2808ef9c
Received: from Venus.fritz.box ([46.223.2.162]) by mail.gmx.net (mrgmx005
 [212.227.17.190]) with ESMTPSA (Nemesis) id 1N4QwW-1neiO41Mpy-011ODK; Tue, 21
 Jun 2022 15:25:38 +0200
From:   Lino Sanfilippo <LinoSanfilippo@gmx.de>
To:     peterhuewe@gmx.de, jarkko@kernel.org, jgg@ziepe.ca
Cc:     stefanb@linux.vnet.ibm.com, linux@mniewoehner.de,
        linux-integrity@vger.kernel.org, linux-kernel@vger.kernel.org,
        l.sanfilippo@kunbus.com, LinoSanfilippo@gmx.de, lukas@wunner.de,
        p.rosenberger@kunbus.com
Subject: [PATCH v6 6/9] tmp, tmp_tis: Implement usage counter for locality
Date:   Tue, 21 Jun 2022 15:24:44 +0200
Message-Id: <20220621132447.16281-7-LinoSanfilippo@gmx.de>
X-Mailer: git-send-email 2.36.1
In-Reply-To: <20220621132447.16281-1-LinoSanfilippo@gmx.de>
References: <20220621132447.16281-1-LinoSanfilippo@gmx.de>
MIME-Version: 1.0
Content-Transfer-Encoding: base64
X-Provags-ID: V03:K1:EucHbQAyhaDO2OFslHJYpn5K9j86a67vVh2xprBNsZmGLRt+qR5
 0UxqXz0bYGV4O480o0mLSwNE72TQrseinaQpAx/pwXllfuNAeFINyfiN4Ui68SbdUsxwD3U
 viSxqvtqkfrPQ4+SySz7GGK0L+Xq00z+u7otqCBfF1aO+/5WAh0rxKJiRUPOPpyFldRYP78
 cM37USIIz6vhlAn6iGhFw==
X-UI-Out-Filterresults: notjunk:1;V03:K0:PWSlkNlO4ss=:e+Lgkg5lFOex/P3Qw8nor9
 zh66PyWzE+FD7xaHCV3X+4wQBdE9GOFX0jLX5qRhClRjCCb92PHZMlPDIFQQY0IXWJd6NbBW+
 UUrl5tYuB4DIVljfKajGzWOO/LKCL7MotnoUAaURJO24lgItAQtrAKj2i4V8+eb9WokN1O/tm
 ezcv2275Zq03lDy+K8NBgEwvSLx9Cgnszxn53oXcSEKC45f2pUDlUzjMzFRvjnatZbjv9fmfg
 iScRC5Ra6AS2wUZAt8uYc5M1ip7/dw3wgV49lSW2b9Tk9zXuEBdABE0vkXQd3uMvo2TK5bG97
 yunn6O98EZp+AXMCtKqqWjylo/LVb5j55E5AaHUGT78jT3LULoPqbEyE1dC8ABJ4gePrAlVu0
 sTuKIEhqhK96bbHXx+/ws/m8gwD4bfkk43U0eiTujXW0wHnwwOEgx6dPZVk/BniC8b6KAW29O
 Io39An7IRoZ5Iaore1PreIhMiavIBLFHSIYMUKd5c4b0dNRLDrpS/1TBzgGB8rKYcTNemxYAX
 9It7UIjkNqXcFkIKVFppZQjUHnQOEpU/pNks0io3D0KX4K+DALyuGn4FRdphQM0dTcUJABTLe
 PKYzGBMKCTVzzAYe+iTPPiVmJ0l8bhGFK5B4vP0bOEzTw5BslgBYZYvENDA/e6hQ625V1Bn97
 oyj06y32u9RuyB52IrUBac9t3b0sKyEPabzPVGvKNr/X4mzF7pHIJq8A7NUO40Hl+N8OcbbFF
 Nv/Ty5xuBRMG+s67Qul9CIdVHN7DoSVHp/otRXe7TROPmdSeebtp4EwVRJawiJ9CiU7cCkYIf
 QGo7ES+cO1M63Oj9/dG8l6n80amLKvqaEBlFdWqEZK70pcYj7amGI5H5eZ2c+J3pQxBuK33rx
 cQAa3CtSVsu92ZRXlMxRdjkVUN2eTvOfxY5UHX0AJIGcLdfnzxIgtlPzwtdf6gGL29hDzV1oY
 RT82qdG1Y8fjswHBe89A7eI9cja3y3Oa2euOf8ORsyi2lNUY+/Z0St2cIkq/JvMwP8VdtTpyD
 IEacZ2uW4D4sazICAi83RFWlS/rsUH9C3FQ7u20tA0xe6yxFd1rut5rbfaobq1buEr8Jsj0s9
 NXpgFcnc8VO1KlnIeztQURhuIClownuAc8QGx0fEF2lt/TtOUSrcOBedA==
X-Spam-Status: No, score=-0.9 required=5.0 tests=BAYES_00,DKIM_SIGNED,
        DKIM_VALID,FREEMAIL_FROM,MIME_BASE64_TEXT,RCVD_IN_DNSWL_LOW,
        RCVD_IN_MSPIKE_H2,SPF_HELO_NONE,SPF_PASS,T_SCC_BODY_TEXT_LINE
        autolearn=ham autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

RnJvbTogTGlubyBTYW5maWxpcHBvIDxsLnNhbmZpbGlwcG9Aa3VuYnVzLmNvbT4KCkltcGxlbWVu
dCBhIHVzYWdlIGNvdW50ZXIgZm9yIHRoZSAoZGVmYXVsdCkgbG9jYWxpdHkgdXNlZCBieSB0aGUg
VFBNIFRJUwpkcml2ZXI6ClJlcXVlc3QgdGhlIGxvY2FsaXR5IGZyb20gdGhlIFRQTSBpZiBpdCBo
YXMgbm90IGJlZW4gY2xhaW1lZCB5ZXQsIG90aGVyd2lzZQpvbmx5IGluY3JlbWVudCB0aGUgY291
bnRlci4gQWxzbyByZWxlYXNlIHRoZSBsb2NhbGl0eSBpZiB0aGUgY291bnRlciBpcyAwCm90aGVy
d2lzZSBvbmx5IGRlY3JlbWVudCB0aGUgY291bnRlci4gRW5zdXJlIHRocmVhZC1zYWZldHkgYnkg
cHJvdGVjdGluZwp0aGUgY291bnRlciB3aXRoIGEgbXV0ZXguCgpUaGlzIGFsbG93cyB0byByZXF1
ZXN0IGFuZCByZWxlYXNlIHRoZSBsb2NhbGl0eSBmcm9tIGEgdGhyZWFkIGFuZCB0aGUKaW50ZXJy
dXB0IGhhbmRsZXIgYXQgdGhlIHNhbWUgdGltZSB3aXRob3V0IHRoZSBkYW5nZXIgdG8gaW50ZXJm
ZXJlIHdpdGgKZWFjaCBvdGhlci4KCkJ5IGRvaW5nIHRoaXMgcmVmYWN0b3IgdGhlIG5hbWVzIG9m
IHRoZSBhbWVuZGVkIGZ1bmN0aW9ucyB0byB1c2UgdGhlIHByb3BlcgpwcmVmaXguCgpTaWduZWQt
b2ZmLWJ5OiBMaW5vIFNhbmZpbGlwcG8gPGwuc2FuZmlsaXBwb0BrdW5idXMuY29tPgotLS0KIGRy
aXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmMgfCA3NSArKysrKysrKysrKysrKysrKysrKysr
LS0tLS0tLS0tLS0KIGRyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmggfCAgMiArCiAyIGZp
bGVzIGNoYW5nZWQsIDUzIGluc2VydGlvbnMoKyksIDI0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmMgYi9kcml2ZXJzL2NoYXIvdHBtL3Rw
bV90aXNfY29yZS5jCmluZGV4IGNiNDY5NTkxMzczYS4uNjM5ODM4YzVjZmUzIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNfY29yZS5jCisrKyBiL2RyaXZlcnMvY2hhci90cG0v
dHBtX3Rpc19jb3JlLmMKQEAgLTE1OCwxNiArMTU4LDI3IEBAIHN0YXRpYyBib29sIGNoZWNrX2xv
Y2FsaXR5KHN0cnVjdCB0cG1fY2hpcCAqY2hpcCwgaW50IGwpCiAJcmV0dXJuIGZhbHNlOwogfQog
Ci1zdGF0aWMgaW50IHJlbGVhc2VfbG9jYWxpdHkoc3RydWN0IHRwbV9jaGlwICpjaGlwLCBpbnQg
bCkKK3N0YXRpYyBpbnQgdHBtX3Rpc19yZWxlYXNlX2xvY2FsaXR5X2xvY2tlZChzdHJ1Y3QgdHBt
X3Rpc19kYXRhICpwcml2LCBpbnQgbCkKK3sKKwl0cG1fdGlzX3dyaXRlOChwcml2LCBUUE1fQUND
RVNTKGwpLCBUUE1fQUNDRVNTX0FDVElWRV9MT0NBTElUWSk7CisKKwlyZXR1cm4gMDsKK30KKwor
c3RhdGljIGludCB0cG1fdGlzX3JlbGVhc2VfbG9jYWxpdHkoc3RydWN0IHRwbV9jaGlwICpjaGlw
LCBpbnQgbCkKIHsKIAlzdHJ1Y3QgdHBtX3Rpc19kYXRhICpwcml2ID0gZGV2X2dldF9kcnZkYXRh
KCZjaGlwLT5kZXYpOwogCi0JdHBtX3Rpc193cml0ZTgocHJpdiwgVFBNX0FDQ0VTUyhsKSwgVFBN
X0FDQ0VTU19BQ1RJVkVfTE9DQUxJVFkpOworCW11dGV4X2xvY2soJnByaXYtPmxvY2FsaXR5X2Nv
dW50X211dGV4KTsKKwlwcml2LT5sb2NhbGl0eV9jb3VudC0tOworCWlmIChwcml2LT5sb2NhbGl0
eV9jb3VudCA9PSAwKQorCQl0cG1fdGlzX3JlbGVhc2VfbG9jYWxpdHlfbG9ja2VkKHByaXYsIGwp
OworCW11dGV4X3VubG9jaygmcHJpdi0+bG9jYWxpdHlfY291bnRfbXV0ZXgpOwogCiAJcmV0dXJu
IDA7CiB9CiAKLXN0YXRpYyBpbnQgcmVxdWVzdF9sb2NhbGl0eShzdHJ1Y3QgdHBtX2NoaXAgKmNo
aXAsIGludCBsKQorc3RhdGljIGludCB0cG1fdGlzX3JlcXVlc3RfbG9jYWxpdHlfbG9ja2VkKHN0
cnVjdCB0cG1fY2hpcCAqY2hpcCwgaW50IGwpCiB7CiAJc3RydWN0IHRwbV90aXNfZGF0YSAqcHJp
diA9IGRldl9nZXRfZHJ2ZGF0YSgmY2hpcC0+ZGV2KTsKIAl1bnNpZ25lZCBsb25nIHN0b3AsIHRp
bWVvdXQ7CkBAIC0yMDgsNiArMjE5LDIwIEBAIHN0YXRpYyBpbnQgcmVxdWVzdF9sb2NhbGl0eShz
dHJ1Y3QgdHBtX2NoaXAgKmNoaXAsIGludCBsKQogCXJldHVybiAtMTsKIH0KIAorc3RhdGljIGlu
dCB0cG1fdGlzX3JlcXVlc3RfbG9jYWxpdHkoc3RydWN0IHRwbV9jaGlwICpjaGlwLCBpbnQgbCkK
K3sKKwlzdHJ1Y3QgdHBtX3Rpc19kYXRhICpwcml2ID0gZGV2X2dldF9kcnZkYXRhKCZjaGlwLT5k
ZXYpOworCWludCByZXQgPSAwOworCisJbXV0ZXhfbG9jaygmcHJpdi0+bG9jYWxpdHlfY291bnRf
bXV0ZXgpOworCWlmIChwcml2LT5sb2NhbGl0eV9jb3VudCA9PSAwKQorCQlyZXQgPSB0cG1fdGlz
X3JlcXVlc3RfbG9jYWxpdHlfbG9ja2VkKGNoaXAsIGwpOworCWlmICghcmV0KQorCQlwcml2LT5s
b2NhbGl0eV9jb3VudCsrOworCW11dGV4X3VubG9jaygmcHJpdi0+bG9jYWxpdHlfY291bnRfbXV0
ZXgpOworCXJldHVybiByZXQ7Cit9CisKIHN0YXRpYyB1OCB0cG1fdGlzX3N0YXR1cyhzdHJ1Y3Qg
dHBtX2NoaXAgKmNoaXApCiB7CiAJc3RydWN0IHRwbV90aXNfZGF0YSAqcHJpdiA9IGRldl9nZXRf
ZHJ2ZGF0YSgmY2hpcC0+ZGV2KTsKQEAgLTY2MSw3ICs2ODYsNyBAQCBzdGF0aWMgaW50IHByb2Jl
X2l0cG0oc3RydWN0IHRwbV9jaGlwICpjaGlwKQogCWlmICh2ZW5kb3IgIT0gVFBNX1ZJRF9JTlRF
TCkKIAkJcmV0dXJuIDA7CiAKLQlpZiAocmVxdWVzdF9sb2NhbGl0eShjaGlwLCAwKSAhPSAwKQor
CWlmICh0cG1fdGlzX3JlcXVlc3RfbG9jYWxpdHkoY2hpcCwgMCkgIT0gMCkKIAkJcmV0dXJuIC1F
QlVTWTsKIAogCXJjID0gdHBtX3Rpc19zZW5kX2RhdGEoY2hpcCwgY21kX2dldHRpY2tzLCBsZW4p
OwpAQCAtNjgyLDcgKzcwNyw3IEBAIHN0YXRpYyBpbnQgcHJvYmVfaXRwbShzdHJ1Y3QgdHBtX2No
aXAgKmNoaXApCiAKIG91dDoKIAl0cG1fdGlzX3JlYWR5KGNoaXApOwotCXJlbGVhc2VfbG9jYWxp
dHkoY2hpcCwgcHJpdi0+bG9jYWxpdHkpOworCXRwbV90aXNfcmVsZWFzZV9sb2NhbGl0eShjaGlw
LCBwcml2LT5sb2NhbGl0eSk7CiAKIAlyZXR1cm4gcmM7CiB9CkBAIC03NDQsNyArNzY5LDcgQEAg
c3RhdGljIGludCB0cG1fdGlzX2dlbl9pbnRlcnJ1cHQoc3RydWN0IHRwbV9jaGlwICpjaGlwKQog
CWNhcF90IGNhcDsKIAlpbnQgcmV0OwogCi0JcmV0ID0gcmVxdWVzdF9sb2NhbGl0eShjaGlwLCAw
KTsKKwlyZXQgPSB0cG1fdGlzX3JlcXVlc3RfbG9jYWxpdHkoY2hpcCwgMCk7CiAJaWYgKHJldCA8
IDApCiAJCXJldHVybiByZXQ7CiAKQEAgLTc1Myw3ICs3NzgsNyBAQCBzdGF0aWMgaW50IHRwbV90
aXNfZ2VuX2ludGVycnVwdChzdHJ1Y3QgdHBtX2NoaXAgKmNoaXApCiAJZWxzZQogCQlyZXQgPSB0
cG0xX2dldGNhcChjaGlwLCBUUE1fQ0FQX1BST1BfVElTX1RJTUVPVVQsICZjYXAsIGRlc2MsIDAp
OwogCi0JcmVsZWFzZV9sb2NhbGl0eShjaGlwLCAwKTsKKwl0cG1fdGlzX3JlbGVhc2VfbG9jYWxp
dHkoY2hpcCwgMCk7CiAKIAlyZXR1cm4gcmV0OwogfQpAQCAtNzc4LDMzICs4MDMsMzMgQEAgc3Rh
dGljIGludCB0cG1fdGlzX3Byb2JlX2lycV9zaW5nbGUoc3RydWN0IHRwbV9jaGlwICpjaGlwLCB1
MzIgaW50bWFzaywKIAl9CiAJcHJpdi0+aXJxID0gaXJxOwogCi0JcmMgPSByZXF1ZXN0X2xvY2Fs
aXR5KGNoaXAsIDApOworCXJjID0gdHBtX3Rpc19yZXF1ZXN0X2xvY2FsaXR5KGNoaXAsIDApOwog
CWlmIChyYyA8IDApCiAJCXJldHVybiByYzsKIAogCXJjID0gdHBtX3Rpc19yZWFkOChwcml2LCBU
UE1fSU5UX1ZFQ1RPUihwcml2LT5sb2NhbGl0eSksCiAJCQkgICAmb3JpZ2luYWxfaW50X3ZlYyk7
CiAJaWYgKHJjIDwgMCkgewotCQlyZWxlYXNlX2xvY2FsaXR5KGNoaXAsIHByaXYtPmxvY2FsaXR5
KTsKKwkJdHBtX3Rpc19yZWxlYXNlX2xvY2FsaXR5KGNoaXAsIHByaXYtPmxvY2FsaXR5KTsKIAkJ
cmV0dXJuIHJjOwogCX0KIAogCXJjID0gdHBtX3Rpc193cml0ZTgocHJpdiwgVFBNX0lOVF9WRUNU
T1IocHJpdi0+bG9jYWxpdHkpLCBpcnEpOwogCWlmIChyYyA8IDApIHsKLQkJcmVsZWFzZV9sb2Nh
bGl0eShjaGlwLCBwcml2LT5sb2NhbGl0eSk7CisJCXRwbV90aXNfcmVsZWFzZV9sb2NhbGl0eShj
aGlwLCBwcml2LT5sb2NhbGl0eSk7CiAJCXJldHVybiByYzsKIAl9CiAKIAlyYyA9IHRwbV90aXNf
cmVhZDMyKHByaXYsIFRQTV9JTlRfU1RBVFVTKHByaXYtPmxvY2FsaXR5KSwgJmludF9zdGF0dXMp
OwogCWlmIChyYyA8IDApIHsKLQkJcmVsZWFzZV9sb2NhbGl0eShjaGlwLCBwcml2LT5sb2NhbGl0
eSk7CisJCXRwbV90aXNfcmVsZWFzZV9sb2NhbGl0eShjaGlwLCBwcml2LT5sb2NhbGl0eSk7CiAJ
CXJldHVybiByYzsKIAl9CiAKIAkvKiBDbGVhciBhbGwgZXhpc3RpbmcgKi8KIAlyYyA9IHRwbV90
aXNfd3JpdGUzMihwcml2LCBUUE1fSU5UX1NUQVRVUyhwcml2LT5sb2NhbGl0eSksIGludF9zdGF0
dXMpOwogCWlmIChyYyA8IDApIHsKLQkJcmVsZWFzZV9sb2NhbGl0eShjaGlwLCBwcml2LT5sb2Nh
bGl0eSk7CisJCXRwbV90aXNfcmVsZWFzZV9sb2NhbGl0eShjaGlwLCBwcml2LT5sb2NhbGl0eSk7
CiAJCXJldHVybiByYzsKIAl9CiAKQEAgLTgxMiwxMSArODM3LDExIEBAIHN0YXRpYyBpbnQgdHBt
X3Rpc19wcm9iZV9pcnFfc2luZ2xlKHN0cnVjdCB0cG1fY2hpcCAqY2hpcCwgdTMyIGludG1hc2ss
CiAJcmMgPSB0cG1fdGlzX3dyaXRlMzIocHJpdiwgVFBNX0lOVF9FTkFCTEUocHJpdi0+bG9jYWxp
dHkpLAogCQkJICAgICBpbnRtYXNrIHwgVFBNX0dMT0JBTF9JTlRfRU5BQkxFKTsKIAlpZiAocmMg
PCAwKSB7Ci0JCXJlbGVhc2VfbG9jYWxpdHkoY2hpcCwgcHJpdi0+bG9jYWxpdHkpOworCQl0cG1f
dGlzX3JlbGVhc2VfbG9jYWxpdHkoY2hpcCwgcHJpdi0+bG9jYWxpdHkpOwogCQlyZXR1cm4gcmM7
CiAJfQogCi0JcmVsZWFzZV9sb2NhbGl0eShjaGlwLCBwcml2LT5sb2NhbGl0eSk7CisJdHBtX3Rp
c19yZWxlYXNlX2xvY2FsaXR5KGNoaXAsIHByaXYtPmxvY2FsaXR5KTsKIAljbGVhcl9iaXQoVFBN
X1RJU19JUlFfVEVTVEVELCAmcHJpdi0+ZmxhZ3MpOwogCiAJLyogR2VuZXJhdGUgYW4gaW50ZXJy
dXB0IGJ5IGhhdmluZyB0aGUgY29yZSBjYWxsIHRocm91Z2ggdG8KQEAgLTk1Miw4ICs5NzcsOCBA
QCBzdGF0aWMgY29uc3Qgc3RydWN0IHRwbV9jbGFzc19vcHMgdHBtX3RpcyA9IHsKIAkucmVxX2Nv
bXBsZXRlX21hc2sgPSBUUE1fU1RTX0RBVEFfQVZBSUwgfCBUUE1fU1RTX1ZBTElELAogCS5yZXFf
Y29tcGxldGVfdmFsID0gVFBNX1NUU19EQVRBX0FWQUlMIHwgVFBNX1NUU19WQUxJRCwKIAkucmVx
X2NhbmNlbGVkID0gdHBtX3Rpc19yZXFfY2FuY2VsZWQsCi0JLnJlcXVlc3RfbG9jYWxpdHkgPSBy
ZXF1ZXN0X2xvY2FsaXR5LAotCS5yZWxpbnF1aXNoX2xvY2FsaXR5ID0gcmVsZWFzZV9sb2NhbGl0
eSwKKwkucmVxdWVzdF9sb2NhbGl0eSA9IHRwbV90aXNfcmVxdWVzdF9sb2NhbGl0eSwKKwkucmVs
aW5xdWlzaF9sb2NhbGl0eSA9IHRwbV90aXNfcmVsZWFzZV9sb2NhbGl0eSwKIAkuY2xrX2VuYWJs
ZSA9IHRwbV90aXNfY2xrcnVuX2VuYWJsZSwKIH07CiAKQEAgLTk4Nyw2ICsxMDEyLDggQEAgaW50
IHRwbV90aXNfY29yZV9pbml0KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IHRwbV90aXNfZGF0
YSAqcHJpdiwgaW50IGlycSwKIAlwcml2LT50aW1lb3V0X21pbiA9IFRQTV9USU1FT1VUX1VTRUNT
X01JTjsKIAlwcml2LT50aW1lb3V0X21heCA9IFRQTV9USU1FT1VUX1VTRUNTX01BWDsKIAlwcml2
LT5waHlfb3BzID0gcGh5X29wczsKKwlwcml2LT5sb2NhbGl0eV9jb3VudCA9IDA7CisJbXV0ZXhf
aW5pdCgmcHJpdi0+bG9jYWxpdHlfY291bnRfbXV0ZXgpOwogCiAJZGV2X3NldF9kcnZkYXRhKCZj
aGlwLT5kZXYsIHByaXYpOwogCkBAIC0xMDY0LDE0ICsxMDkxLDE0IEBAIGludCB0cG1fdGlzX2Nv
cmVfaW5pdChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCB0cG1fdGlzX2RhdGEgKnByaXYsIGlu
dCBpcnEsCiAKIAlpbnRtYXNrICY9IH5UUE1fR0xPQkFMX0lOVF9FTkFCTEU7CiAKLQlyYyA9IHJl
cXVlc3RfbG9jYWxpdHkoY2hpcCwgMCk7CisJcmMgPSB0cG1fdGlzX3JlcXVlc3RfbG9jYWxpdHko
Y2hpcCwgMCk7CiAJaWYgKHJjIDwgMCkgewogCQlyYyA9IC1FTk9ERVY7CiAJCWdvdG8gb3V0X2Vy
cjsKIAl9CiAKIAl0cG1fdGlzX3dyaXRlMzIocHJpdiwgVFBNX0lOVF9FTkFCTEUocHJpdi0+bG9j
YWxpdHkpLCBpbnRtYXNrKTsKLQlyZWxlYXNlX2xvY2FsaXR5KGNoaXAsIDApOworCXRwbV90aXNf
cmVsZWFzZV9sb2NhbGl0eShjaGlwLCAwKTsKIAogCXJjID0gdHBtX2NoaXBfc3RhcnQoY2hpcCk7
CiAJaWYgKHJjKQpAQCAtMTEwNSwxMyArMTEzMiwxMyBAQCBpbnQgdHBtX3Rpc19jb3JlX2luaXQo
c3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgdHBtX3Rpc19kYXRhICpwcml2LCBpbnQgaXJxLAog
CQkgKiBwcm9wZXIgdGltZW91dHMgZm9yIHRoZSBkcml2ZXIuCiAJCSAqLwogCi0JCXJjID0gcmVx
dWVzdF9sb2NhbGl0eShjaGlwLCAwKTsKKwkJcmMgPSB0cG1fdGlzX3JlcXVlc3RfbG9jYWxpdHko
Y2hpcCwgMCk7CiAJCWlmIChyYyA8IDApCiAJCQlnb3RvIG91dF9lcnI7CiAKIAkJcmMgPSB0cG1f
Z2V0X3RpbWVvdXRzKGNoaXApOwogCi0JCXJlbGVhc2VfbG9jYWxpdHkoY2hpcCwgMCk7CisJCXRw
bV90aXNfcmVsZWFzZV9sb2NhbGl0eShjaGlwLCAwKTsKIAogCQlpZiAocmMpIHsKIAkJCWRldl9l
cnIoZGV2LCAiQ291bGQgbm90IGdldCBUUE0gdGltZW91dHMgYW5kIGR1cmF0aW9uc1xuIik7CkBA
IC0xMTMxLDExICsxMTU4LDExIEBAIGludCB0cG1fdGlzX2NvcmVfaW5pdChzdHJ1Y3QgZGV2aWNl
ICpkZXYsIHN0cnVjdCB0cG1fdGlzX2RhdGEgKnByaXYsIGludCBpcnEsCiAJCQlkZXZfZXJyKCZj
aGlwLT5kZXYsIEZXX0JVRwogCQkJCQkiVFBNIGludGVycnVwdCBub3Qgd29ya2luZywgcG9sbGlu
ZyBpbnN0ZWFkXG4iKTsKIAotCQkJcmMgPSByZXF1ZXN0X2xvY2FsaXR5KGNoaXAsIDApOworCQkJ
cmMgPSB0cG1fdGlzX3JlcXVlc3RfbG9jYWxpdHkoY2hpcCwgMCk7CiAJCQlpZiAocmMgPCAwKQog
CQkJCWdvdG8gb3V0X2VycjsKIAkJCWRpc2FibGVfaW50ZXJydXB0cyhjaGlwKTsKLQkJCXJlbGVh
c2VfbG9jYWxpdHkoY2hpcCwgMCk7CisJCQl0cG1fdGlzX3JlbGVhc2VfbG9jYWxpdHkoY2hpcCwg
MCk7CiAJCX0KIAl9CiAKQEAgLTEyMDIsMTMgKzEyMjksMTMgQEAgaW50IHRwbV90aXNfcmVzdW1l
KHN0cnVjdCBkZXZpY2UgKmRldikKIAkgKiBhbiBlcnJvciBjb2RlIGJ1dCBmb3IgdW5rbm93biBy
ZWFzb24gaXQgaXNuJ3QgaGFuZGxlZC4KIAkgKi8KIAlpZiAoIShjaGlwLT5mbGFncyAmIFRQTV9D
SElQX0ZMQUdfVFBNMikpIHsKLQkJcmV0ID0gcmVxdWVzdF9sb2NhbGl0eShjaGlwLCAwKTsKKwkJ
cmV0ID0gdHBtX3Rpc19yZXF1ZXN0X2xvY2FsaXR5KGNoaXAsIDApOwogCQlpZiAocmV0IDwgMCkK
IAkJCXJldHVybiByZXQ7CiAKIAkJdHBtMV9kb19zZWxmdGVzdChjaGlwKTsKIAotCQlyZWxlYXNl
X2xvY2FsaXR5KGNoaXAsIDApOworCQl0cG1fdGlzX3JlbGVhc2VfbG9jYWxpdHkoY2hpcCwgMCk7
CiAJfQogCiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNf
Y29yZS5oIGIvZHJpdmVycy9jaGFyL3RwbS90cG1fdGlzX2NvcmUuaAppbmRleCBlMDA1ZWI5OTQ4
MGUuLjdjNmMxNDcwN2UzMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9jaGFyL3RwbS90cG1fdGlzX2Nv
cmUuaAorKysgYi9kcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNfY29yZS5oCkBAIC05MSw2ICs5MSw4
IEBAIGVudW0gdHBtX3Rpc19mbGFncyB7CiAKIHN0cnVjdCB0cG1fdGlzX2RhdGEgewogCXUxNiBt
YW51ZmFjdHVyZXJfaWQ7CisJc3RydWN0IG11dGV4IGxvY2FsaXR5X2NvdW50X211dGV4OworCXVu
c2lnbmVkIGludCBsb2NhbGl0eV9jb3VudDsKIAlpbnQgbG9jYWxpdHk7CiAJaW50IGlycTsKIAl1
bnNpZ25lZCBpbnQgaW50X21hc2s7Ci0tIAoyLjM2LjEKCg==
