Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id D990F560D39
	for <lists+linux-kernel@lfdr.de>; Thu, 30 Jun 2022 01:28:44 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S231563AbiF2X2S (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Wed, 29 Jun 2022 19:28:18 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:33332 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S231231AbiF2X1j (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Wed, 29 Jun 2022 19:27:39 -0400
Received: from mout.gmx.net (mout.gmx.net [212.227.15.15])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id BDB91255B9;
        Wed, 29 Jun 2022 16:27:37 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=gmx.net;
        s=badeba3b8450; t=1656545245;
        bh=OxT6orG/M1ZoEPE31KTuTtlu7fY3J7clKbTWUReYR3E=;
        h=X-UI-Sender-Class:From:To:Cc:Subject:Date:In-Reply-To:References;
        b=AICp0kL+UNCRRslzxDIC3IorVL/hk2Xh8wm7n1fgMMoxrgcsjhk0gm7vq2uMMKDqz
         LDuC2oDDfi3P0sTQCfxAv1c+/QkSsNGIfvmfMdysMCNa80UfE/dZNn3qD2llIxdW2Q
         bxUc8zCIe7bgYMCI+mwSNAOZol/komn/tfudTlXo=
X-UI-Sender-Class: 01bb95c1-4bf8-414a-932a-4f6e2808ef9c
Received: from localhost.localdomain ([46.223.3.23]) by mail.gmx.net (mrgmx004
 [212.227.17.190]) with ESMTPSA (Nemesis) id 1MK3Rs-1oLSWB0XFe-00LXS5; Thu, 30
 Jun 2022 01:27:25 +0200
From:   Lino Sanfilippo <LinoSanfilippo@gmx.de>
To:     peterhuewe@gmx.de, jarkko@kernel.org, jgg@ziepe.ca
Cc:     stefanb@linux.vnet.ibm.com, linux@mniewoehner.de,
        linux-integrity@vger.kernel.org, linux-kernel@vger.kernel.org,
        l.sanfilippo@kunbus.com, LinoSanfilippo@gmx.de, lukas@wunner.de,
        p.rosenberger@kunbus.com
Subject: [PATCH v7 05/10] tpm, tpm_tis: Only handle supported interrupts
Date:   Thu, 30 Jun 2022 01:26:48 +0200
Message-Id: <20220629232653.1306735-6-LinoSanfilippo@gmx.de>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20220629232653.1306735-1-LinoSanfilippo@gmx.de>
References: <20220629232653.1306735-1-LinoSanfilippo@gmx.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: base64
X-Provags-ID: V03:K1:YG934ZGUnKJQRghRcLKlPcTHwIXbpcVYxg/nNlYt0aycyfeLYjB
 Vzxm4atoO4qDUKm7TuVHx22Xs8LeLk8vg64+VxXv1aR85pXqbx5oLYi+jxUvavBg/7TnUXi
 FW9GReqDrfJX3+n7td4MFD29MShLW1RiV9NqEFPRNgzymA0jBghcJK879Y6KbaR1KRBjVaX
 lF4jrrcrIbBl23980FYYA==
X-UI-Out-Filterresults: notjunk:1;V03:K0:l95XRWW19XU=:bsoR4jlGol1mxZubUDJvdO
 tfiuzWkcdAZZ/0PZZcWGi4QQDZQBQlM2CHfm+mLTb5HN7qWziVEOCGlfbd3SmVAdu9GtwVOGU
 0HMDzPNt5Ehl8peIJJGFMDd5CNIVvgSX05LqQPVdqI8w9f1B8/E1FxBsx2daaQWQut8IWPYJN
 YscYBOTRtR2TJEasuFRgzA7nI0ZMnjAVMAgWfcqPkjXCuH4iFl8M6Clw+nasqU9bl3a6HdwW5
 kXydEN71S/fS3lTyEv7n70JF94wb6KUm3tnUCfgwgAo9O+9/S3V5CCwPXd3nsibxODVOGc0HP
 xFnNoKDuMvZFq4gHr0oURpZoZT3YBcLQyu/8yCQmS3pF1Oervf0Pll3wo+6G8i4KwdDpQFjna
 TwdWyn4skEhofhyZEhfFAHf4koCyjyte0WPaE18MacKcqMRLkKkFYFh0ZHDWu5iOLTs02N9VB
 tbyHWcrdnvvL6usmXS0I67zfV47t+1TQNA5fREwPCJOdXXMDeMD5fN0JIPAhxbbUNq5ZfXfE5
 AhV1UTZWbusE6kfg7dN7yuR0P27qTn8E5yVZB53HHaCsnzNeoGnkEg/gvZ4A0cnBBTVaOJ+E6
 8ln707k1Ti76PZRmKJGqJ9T0yrZEtLeGuXCwR3jfP7x8W7pZXtgF315YZwhnxiD5KLI50zF6p
 7EpQPnaLVbDPF1Vp78OFGIP60/U4i06t9oPf/LiXZVgmvxCt4Y6HehaeO45kLnEUBfQPCiYYa
 TC1A7TRbHuYIF3gWwZPCJJ4gd3UaRLiCIbGnk99FvwTeEgDcb986C7NYE4RtXhMMXrjRo++zs
 SGYtvupu/6IpWW1ruoc5rIOy0Qnb9ApKBMCWRFEg77GEm6L47P8OiPmVkjr6+BCMDJcbaEZFJ
 XfytOLy3V1dpC7f+eh9+SjdXmCH1oxn2Rtfh0XIrk9sL0y1/2/OALbSB+pdffyAd3ifJ5hpso
 z6FU/+UqGBcQPRzqbkJ7ifT+qQ5JgT++pMnv/wm8RjwplzJuQKCg1yfH9tEyM/4J4EsWiBcX4
 rn5p+usSdKqPGCHZ4oyVnTW8vp56N7NFzRzQJowgf2OZbUZm3GGSkOSZ0QaFi5ahe0SheUvjh
 kT7gNrfSOOEZZpz4nRCTiYva4BzgVwj4cw6W703FUWYJp0UE75D3qAygg==
X-Spam-Status: No, score=-2.6 required=5.0 tests=BAYES_00,DKIM_SIGNED,
        DKIM_VALID,FREEMAIL_FROM,RCVD_IN_DNSWL_LOW,RCVD_IN_MSPIKE_H2,
        SPF_HELO_NONE,SPF_PASS,T_SCC_BODY_TEXT_LINE autolearn=ham
        autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

RnJvbTogTGlubyBTYW5maWxpcHBvIDxsLnNhbmZpbGlwcG9Aa3VuYnVzLmNvbT4KCkFjY29yZGlu
ZyB0byB0aGUgVFBNIEludGVyZmFjZSBTcGVjaWZpY2F0aW9uIChUSVMpIHN1cHBvcnQgZm9yICJz
dHNWYWxpZCIKYW5kICJjb21tYW5kUmVhZHkiIGludGVycnVwdHMgaXMgb25seSBvcHRpb25hbC4K
VGhpcyBoYXMgdG8gYmUgdGFrZW4gaW50byBhY2NvdW50IHdoZW4gaGFuZGxpbmcgdGhlIGludGVy
cnVwdHMgaW4gZnVuY3Rpb25zCmxpa2Ugd2FpdF9mb3JfdHBtX3N0YXQoKS4gVG8gZGV0ZXJtaW5l
IHRoZSBzdXBwb3J0ZWQgaW50ZXJydXB0cyB1c2UgdGhlCmNhcGFiaWxpdHkgcXVlcnkuCgpBbHNv
IGFkanVzdCB3YWl0X2Zvcl90cG1fc3RhdCgpIHRvIG9ubHkgd2FpdCBmb3IgaW50ZXJydXB0IHJl
cG9ydGVkIHN0YXR1cwpjaGFuZ2VzLiBBZnRlciB0aGF0IHByb2Nlc3MgYWxsIHRoZSByZW1haW5p
bmcgc3RhdHVzIGNoYW5nZXMgYnkgcG9sbGluZwp0aGUgc3RhdHVzIHJlZ2lzdGVyLgoKU2lnbmVk
LW9mZi1ieTogTGlubyBTYW5maWxpcHBvIDxsLnNhbmZpbGlwcG9Aa3VuYnVzLmNvbT4KVGVzdGVk
LWJ5OiBNaWNoYWVsIE5pZXfDtmhuZXIgPGxpbnV4QG1uaWV3b2VobmVyLmRlPgotLS0KIGRyaXZl
cnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmMgfCAxMTkgKysrKysrKysrKysrKysrKysrKy0tLS0t
LS0tLS0tLS0KIGRyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmggfCAgIDEgKwogMiBmaWxl
cyBjaGFuZ2VkLCA3MiBpbnNlcnRpb25zKCspLCA0OCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNfY29yZS5jIGIvZHJpdmVycy9jaGFyL3RwbS90cG1f
dGlzX2NvcmUuYwppbmRleCAwOWQ4ZjA0Y2JjODEuLmMxMzU5OWU5NGFiNiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9jaGFyL3RwbS90cG1fdGlzX2NvcmUuYworKysgYi9kcml2ZXJzL2NoYXIvdHBtL3Rw
bV90aXNfY29yZS5jCkBAIC01Myw0MSArNTMsNjMgQEAgc3RhdGljIGludCB3YWl0X2Zvcl90cG1f
c3RhdChzdHJ1Y3QgdHBtX2NoaXAgKmNoaXAsIHU4IG1hc2ssCiAJbG9uZyByYzsKIAl1OCBzdGF0
dXM7CiAJYm9vbCBjYW5jZWxlZCA9IGZhbHNlOworCXU4IHN0c19tYXNrID0gMDsKKwlpbnQgcmV0
ID0gMDsKIAogCS8qIGNoZWNrIGN1cnJlbnQgc3RhdHVzICovCiAJc3RhdHVzID0gY2hpcC0+b3Bz
LT5zdGF0dXMoY2hpcCk7CiAJaWYgKChzdGF0dXMgJiBtYXNrKSA9PSBtYXNrKQogCQlyZXR1cm4g
MDsKIAotCXN0b3AgPSBqaWZmaWVzICsgdGltZW91dDsKKwkvKiBjaGVjayB3aGljaCBzdGF0dXMg
Y2hhbmdlcyBjYW4gYmUgaGFuZGxlZCBieSBpcnFzICovCisJaWYgKHByaXYtPmludF9tYXNrICYg
VFBNX0lOVEZfU1RTX1ZBTElEX0lOVCkKKwkJc3RzX21hc2sgfD0gVFBNX1NUU19WQUxJRDsKIAot
CWlmIChjaGlwLT5mbGFncyAmIFRQTV9DSElQX0ZMQUdfSVJRKSB7CisJaWYgKHByaXYtPmludF9t
YXNrICYgVFBNX0lOVEZfREFUQV9BVkFJTF9JTlQpCisJCXN0c19tYXNrIHw9IFRQTV9TVFNfREFU
QV9BVkFJTDsKKworCWlmIChwcml2LT5pbnRfbWFzayAmIFRQTV9JTlRGX0NNRF9SRUFEWV9JTlQp
CisJCXN0c19tYXNrIHw9IFRQTV9TVFNfQ09NTUFORF9SRUFEWTsKKworCXN0c19tYXNrICY9IG1h
c2s7CisKKwlzdG9wID0gamlmZmllcyArIHRpbWVvdXQ7CisJLyogcHJvY2VzcyBzdGF0dXMgY2hh
bmdlcyB3aXRoIGlycSBzdXBwb3J0ICovCisJaWYgKHN0c19tYXNrKSB7CisJCXJldCA9IC1FVElN
RTsKIGFnYWluOgogCQl0aW1lb3V0ID0gc3RvcCAtIGppZmZpZXM7CiAJCWlmICgobG9uZyl0aW1l
b3V0IDw9IDApCiAJCQlyZXR1cm4gLUVUSU1FOwogCQlyYyA9IHdhaXRfZXZlbnRfaW50ZXJydXB0
aWJsZV90aW1lb3V0KCpxdWV1ZSwKLQkJCXdhaXRfZm9yX3RwbV9zdGF0X2NvbmQoY2hpcCwgbWFz
aywgY2hlY2tfY2FuY2VsLAorCQkJd2FpdF9mb3JfdHBtX3N0YXRfY29uZChjaGlwLCBzdHNfbWFz
aywgY2hlY2tfY2FuY2VsLAogCQkJCQkgICAgICAgJmNhbmNlbGVkKSwKIAkJCXRpbWVvdXQpOwog
CQlpZiAocmMgPiAwKSB7CiAJCQlpZiAoY2FuY2VsZWQpCiAJCQkJcmV0dXJuIC1FQ0FOQ0VMRUQ7
Ci0JCQlyZXR1cm4gMDsKKwkJCXJldCA9IDA7CiAJCX0KIAkJaWYgKHJjID09IC1FUkVTVEFSVFNZ
UyAmJiBmcmVlemluZyhjdXJyZW50KSkgewogCQkJY2xlYXJfdGhyZWFkX2ZsYWcoVElGX1NJR1BF
TkRJTkcpOwogCQkJZ290byBhZ2FpbjsKIAkJfQotCX0gZWxzZSB7Ci0JCWRvIHsKLQkJCXVzbGVl
cF9yYW5nZShwcml2LT50aW1lb3V0X21pbiwKLQkJCQkgICAgIHByaXYtPnRpbWVvdXRfbWF4KTsK
LQkJCXN0YXR1cyA9IGNoaXAtPm9wcy0+c3RhdHVzKGNoaXApOwotCQkJaWYgKChzdGF0dXMgJiBt
YXNrKSA9PSBtYXNrKQotCQkJCXJldHVybiAwOwotCQl9IHdoaWxlICh0aW1lX2JlZm9yZShqaWZm
aWVzLCBzdG9wKSk7CiAJfQorCisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCW1hc2sgJj0g
fnN0c19tYXNrOworCWlmICghbWFzaykgLyogYWxsIGRvbmUgKi8KKwkJcmV0dXJuIDA7CisJLyog
cHJvY2VzcyBzdGF0dXMgY2hhbmdlcyB3aXRob3V0IGlycSBzdXBwb3J0ICovCisJZG8geworCQlz
dGF0dXMgPSBjaGlwLT5vcHMtPnN0YXR1cyhjaGlwKTsKKwkJaWYgKChzdGF0dXMgJiBtYXNrKSA9
PSBtYXNrKQorCQkJcmV0dXJuIDA7CisJCXVzbGVlcF9yYW5nZShwcml2LT50aW1lb3V0X21pbiwK
KwkJCSAgICAgcHJpdi0+dGltZW91dF9tYXgpOworCX0gd2hpbGUgKHRpbWVfYmVmb3JlKGppZmZp
ZXMsIHN0b3ApKTsKIAlyZXR1cm4gLUVUSU1FOwogfQogCkBAIC0xMDA3LDggKzEwMjksMzkgQEAg
aW50IHRwbV90aXNfY29yZV9pbml0KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IHRwbV90aXNf
ZGF0YSAqcHJpdiwgaW50IGlycSwKIAlpZiAocmMgPCAwKQogCQlnb3RvIG91dF9lcnI7CiAKLQlp
bnRtYXNrIHw9IFRQTV9JTlRGX0NNRF9SRUFEWV9JTlQgfCBUUE1fSU5URl9MT0NBTElUWV9DSEFO
R0VfSU5UIHwKLQkJICAgVFBNX0lOVEZfREFUQV9BVkFJTF9JTlQgfCBUUE1fSU5URl9TVFNfVkFM
SURfSU5UOworCS8qIEZpZ3VyZSBvdXQgdGhlIGNhcGFiaWxpdGllcyAqLworCXJjID0gdHBtX3Rp
c19yZWFkMzIocHJpdiwgVFBNX0lOVEZfQ0FQUyhwcml2LT5sb2NhbGl0eSksICZpbnRmY2Fwcyk7
CisJaWYgKHJjIDwgMCkKKwkJZ290byBvdXRfZXJyOworCisJZGV2X2RiZyhkZXYsICJUUE0gaW50
ZXJmYWNlIGNhcGFiaWxpdGllcyAoMHgleCk6XG4iLAorCQlpbnRmY2Fwcyk7CisJaWYgKGludGZj
YXBzICYgVFBNX0lOVEZfQlVSU1RfQ09VTlRfU1RBVElDKQorCQlkZXZfZGJnKGRldiwgIlx0QnVy
c3QgQ291bnQgU3RhdGljXG4iKTsKKwlpZiAoaW50ZmNhcHMgJiBUUE1fSU5URl9DTURfUkVBRFlf
SU5UKSB7CisJCWludG1hc2sgfD0gVFBNX0lOVEZfQ01EX1JFQURZX0lOVDsKKwkJZGV2X2RiZyhk
ZXYsICJcdENvbW1hbmQgUmVhZHkgSW50IFN1cHBvcnRcbiIpOworCX0KKwlpZiAoaW50ZmNhcHMg
JiBUUE1fSU5URl9JTlRfRURHRV9GQUxMSU5HKQorCQlkZXZfZGJnKGRldiwgIlx0SW50ZXJydXB0
IEVkZ2UgRmFsbGluZ1xuIik7CisJaWYgKGludGZjYXBzICYgVFBNX0lOVEZfSU5UX0VER0VfUklT
SU5HKQorCQlkZXZfZGJnKGRldiwgIlx0SW50ZXJydXB0IEVkZ2UgUmlzaW5nXG4iKTsKKwlpZiAo
aW50ZmNhcHMgJiBUUE1fSU5URl9JTlRfTEVWRUxfTE9XKQorCQlkZXZfZGJnKGRldiwgIlx0SW50
ZXJydXB0IExldmVsIExvd1xuIik7CisJaWYgKGludGZjYXBzICYgVFBNX0lOVEZfSU5UX0xFVkVM
X0hJR0gpCisJCWRldl9kYmcoZGV2LCAiXHRJbnRlcnJ1cHQgTGV2ZWwgSGlnaFxuIik7CisJaWYg
KGludGZjYXBzICYgVFBNX0lOVEZfTE9DQUxJVFlfQ0hBTkdFX0lOVCkKKwkJaW50bWFzayB8PSBU
UE1fSU5URl9MT0NBTElUWV9DSEFOR0VfSU5UOworCQlkZXZfZGJnKGRldiwgIlx0TG9jYWxpdHkg
Q2hhbmdlIEludCBTdXBwb3J0XG4iKTsKKwlpZiAoaW50ZmNhcHMgJiBUUE1fSU5URl9TVFNfVkFM
SURfSU5UKSB7CisJCWludG1hc2sgfD0gVFBNX0lOVEZfU1RTX1ZBTElEX0lOVDsKKwkJZGV2X2Ri
ZyhkZXYsICJcdFN0cyBWYWxpZCBJbnQgU3VwcG9ydFxuIik7CisJfQorCWlmIChpbnRmY2FwcyAm
IFRQTV9JTlRGX0RBVEFfQVZBSUxfSU5UKSB7CisJCWludG1hc2sgfD0gVFBNX0lOVEZfREFUQV9B
VkFJTF9JTlQ7CisJCWRldl9kYmcoZGV2LCAiXHREYXRhIEF2YWlsIEludCBTdXBwb3J0XG4iKTsK
Kwl9CisKIAlpbnRtYXNrICY9IH5UUE1fR0xPQkFMX0lOVF9FTkFCTEU7CiAKIAlyYyA9IHJlcXVl
c3RfbG9jYWxpdHkoY2hpcCwgMCk7CkBAIC0xMDQyLDMyICsxMDk1LDYgQEAgaW50IHRwbV90aXNf
Y29yZV9pbml0KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IHRwbV90aXNfZGF0YSAqcHJpdiwg
aW50IGlycSwKIAkJZ290byBvdXRfZXJyOwogCX0KIAotCS8qIEZpZ3VyZSBvdXQgdGhlIGNhcGFi
aWxpdGllcyAqLwotCXJjID0gdHBtX3Rpc19yZWFkMzIocHJpdiwgVFBNX0lOVEZfQ0FQUyhwcml2
LT5sb2NhbGl0eSksICZpbnRmY2Fwcyk7Ci0JaWYgKHJjIDwgMCkKLQkJZ290byBvdXRfZXJyOwot
Ci0JZGV2X2RiZyhkZXYsICJUUE0gaW50ZXJmYWNlIGNhcGFiaWxpdGllcyAoMHgleCk6XG4iLAot
CQlpbnRmY2Fwcyk7Ci0JaWYgKGludGZjYXBzICYgVFBNX0lOVEZfQlVSU1RfQ09VTlRfU1RBVElD
KQotCQlkZXZfZGJnKGRldiwgIlx0QnVyc3QgQ291bnQgU3RhdGljXG4iKTsKLQlpZiAoaW50ZmNh
cHMgJiBUUE1fSU5URl9DTURfUkVBRFlfSU5UKQotCQlkZXZfZGJnKGRldiwgIlx0Q29tbWFuZCBS
ZWFkeSBJbnQgU3VwcG9ydFxuIik7Ci0JaWYgKGludGZjYXBzICYgVFBNX0lOVEZfSU5UX0VER0Vf
RkFMTElORykKLQkJZGV2X2RiZyhkZXYsICJcdEludGVycnVwdCBFZGdlIEZhbGxpbmdcbiIpOwot
CWlmIChpbnRmY2FwcyAmIFRQTV9JTlRGX0lOVF9FREdFX1JJU0lORykKLQkJZGV2X2RiZyhkZXYs
ICJcdEludGVycnVwdCBFZGdlIFJpc2luZ1xuIik7Ci0JaWYgKGludGZjYXBzICYgVFBNX0lOVEZf
SU5UX0xFVkVMX0xPVykKLQkJZGV2X2RiZyhkZXYsICJcdEludGVycnVwdCBMZXZlbCBMb3dcbiIp
OwotCWlmIChpbnRmY2FwcyAmIFRQTV9JTlRGX0lOVF9MRVZFTF9ISUdIKQotCQlkZXZfZGJnKGRl
diwgIlx0SW50ZXJydXB0IExldmVsIEhpZ2hcbiIpOwotCWlmIChpbnRmY2FwcyAmIFRQTV9JTlRG
X0xPQ0FMSVRZX0NIQU5HRV9JTlQpCi0JCWRldl9kYmcoZGV2LCAiXHRMb2NhbGl0eSBDaGFuZ2Ug
SW50IFN1cHBvcnRcbiIpOwotCWlmIChpbnRmY2FwcyAmIFRQTV9JTlRGX1NUU19WQUxJRF9JTlQp
Ci0JCWRldl9kYmcoZGV2LCAiXHRTdHMgVmFsaWQgSW50IFN1cHBvcnRcbiIpOwotCWlmIChpbnRm
Y2FwcyAmIFRQTV9JTlRGX0RBVEFfQVZBSUxfSU5UKQotCQlkZXZfZGJnKGRldiwgIlx0RGF0YSBB
dmFpbCBJbnQgU3VwcG9ydFxuIik7Ci0KIAkvKiBJTlRFUlJVUFQgU2V0dXAgKi8KIAlpbml0X3dh
aXRxdWV1ZV9oZWFkKCZwcml2LT5yZWFkX3F1ZXVlKTsKIAlpbml0X3dhaXRxdWV1ZV9oZWFkKCZw
cml2LT5pbnRfcXVldWUpOwpAQCAtMTA5OCw3ICsxMTI1LDkgQEAgaW50IHRwbV90aXNfY29yZV9p
bml0KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IHRwbV90aXNfZGF0YSAqcHJpdiwgaW50IGly
cSwKIAkJZWxzZQogCQkJdHBtX3Rpc19wcm9iZV9pcnEoY2hpcCwgaW50bWFzayk7CiAKLQkJaWYg
KCEoY2hpcC0+ZmxhZ3MgJiBUUE1fQ0hJUF9GTEFHX0lSUSkpIHsKKwkJaWYgKGNoaXAtPmZsYWdz
ICYgVFBNX0NISVBfRkxBR19JUlEpIHsKKwkJCXByaXYtPmludF9tYXNrID0gaW50bWFzazsKKwkJ
fSBlbHNlIHsKIAkJCWRldl9lcnIoJmNoaXAtPmRldiwgRldfQlVHCiAJCQkJCSJUUE0gaW50ZXJy
dXB0IG5vdCB3b3JraW5nLCBwb2xsaW5nIGluc3RlYWRcbiIpOwogCkBAIC0xMTQ1LDEzICsxMTc0
LDcgQEAgc3RhdGljIHZvaWQgdHBtX3Rpc19yZWVuYWJsZV9pbnRlcnJ1cHRzKHN0cnVjdCB0cG1f
Y2hpcCAqY2hpcCkKIAlpZiAocmMgPCAwKQogCQlnb3RvIG91dDsKIAotCXJjID0gdHBtX3Rpc19y
ZWFkMzIocHJpdiwgVFBNX0lOVF9FTkFCTEUocHJpdi0+bG9jYWxpdHkpLCAmaW50bWFzayk7Ci0J
aWYgKHJjIDwgMCkKLQkJZ290byBvdXQ7Ci0KLQlpbnRtYXNrIHw9IFRQTV9JTlRGX0NNRF9SRUFE
WV9JTlQKLQkgICAgfCBUUE1fSU5URl9MT0NBTElUWV9DSEFOR0VfSU5UIHwgVFBNX0lOVEZfREFU
QV9BVkFJTF9JTlQKLQkgICAgfCBUUE1fSU5URl9TVFNfVkFMSURfSU5UIHwgVFBNX0dMT0JBTF9J
TlRfRU5BQkxFOworCWludG1hc2sgPSBwcml2LT5pbnRfbWFzayB8IFRQTV9HTE9CQUxfSU5UX0VO
QUJMRTsKIAogCXRwbV90aXNfd3JpdGUzMihwcml2LCBUUE1fSU5UX0VOQUJMRShwcml2LT5sb2Nh
bGl0eSksIGludG1hc2spOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNf
Y29yZS5oIGIvZHJpdmVycy9jaGFyL3RwbS90cG1fdGlzX2NvcmUuaAppbmRleCBiZjA3Mzc5ZGVh
NDIuLmUwMDVlYjk5NDgwZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9jaGFyL3RwbS90cG1fdGlzX2Nv
cmUuaAorKysgYi9kcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNfY29yZS5oCkBAIC05Myw2ICs5Myw3
IEBAIHN0cnVjdCB0cG1fdGlzX2RhdGEgewogCXUxNiBtYW51ZmFjdHVyZXJfaWQ7CiAJaW50IGxv
Y2FsaXR5OwogCWludCBpcnE7CisJdW5zaWduZWQgaW50IGludF9tYXNrOwogCXVuc2lnbmVkIGxv
bmcgZmxhZ3M7CiAJdm9pZCBfX2lvbWVtICppbGJfYmFzZV9hZGRyOwogCXUxNiBjbGtydW5fZW5h
YmxlZDsKLS0gCjIuMjUuMQoK
