Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 96D134D5D51
	for <lists+linux-kernel@lfdr.de>; Fri, 11 Mar 2022 09:31:00 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S238232AbiCKIb4 (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Fri, 11 Mar 2022 03:31:56 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:48114 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S238598AbiCKIby (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 11 Mar 2022 03:31:54 -0500
Received: from smtp-out2.suse.de (smtp-out2.suse.de [195.135.220.29])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 93A741B8FF7
        for <linux-kernel@vger.kernel.org>; Fri, 11 Mar 2022 00:30:51 -0800 (PST)
Received: from relay2.suse.de (relay2.suse.de [149.44.160.134])
        by smtp-out2.suse.de (Postfix) with ESMTP id 2B7E41F441;
        Fri, 11 Mar 2022 08:30:50 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.de; s=susede2_rsa;
        t=1646987450; h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
         mime-version:mime-version:content-type:content-type:
         content-transfer-encoding:content-transfer-encoding:
         in-reply-to:in-reply-to:references:references;
        bh=dzGcwM7v+f34q9OHR146SuStt4YJu5AWHYm6yTSEKbU=;
        b=VN+qHiXECN9MeWHI6qSXge+yel8gPdwl2Vp8yAg/VuNjvwOdqDdSepXjm9VAgjlgEg2/XV
        whFUy28AcFcgi8Or3j1P/VBicHdar4zDrEq2C+nE/8YkdNTcpYtNGfMI2QQVEcR3+Jfl19
        nMS23lpKQCBdCI9JHkkBcSv99h1E4VA=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.de;
        s=susede2_ed25519; t=1646987450;
        h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
         mime-version:mime-version:content-type:content-type:
         content-transfer-encoding:content-transfer-encoding:
         in-reply-to:in-reply-to:references:references;
        bh=dzGcwM7v+f34q9OHR146SuStt4YJu5AWHYm6yTSEKbU=;
        b=hYQytmMrUrlQ/l8hINoIKeISYAqXeTfzMjJZc1EwUnqwjrKQOgjSwI/p46vgpzEUcSdlzM
        8113T2KyKJ4nRXBQ==
Received: from alsa1.suse.de (alsa1.suse.de [10.160.4.42])
        by relay2.suse.de (Postfix) with ESMTP id 77DECA3B93;
        Fri, 11 Mar 2022 08:30:49 +0000 (UTC)
Date:   Fri, 11 Mar 2022 09:30:49 +0100
Message-ID: <s5ho82cevra.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     "huangwenhui" <huangwenhuia@uniontech.com>
Cc:     "perex" <perex@perex.cz>, "tiwai" <tiwai@suse.com>,
        "jeremy.szu" <jeremy.szu@canonical.com>,
        "hui.wang" <hui.wang@canonical.com>,
        "wse" <wse@tuxedocomputers.com>, "cam" <cam@neo-zeon.de>,
        "kailang" <kailang@realtek.com>,
        "tanureal" <tanureal@opensource.cirrus.com>,
        "sami" <sami@loone.fi>, "alsa-devel" <alsa-devel@alsa-project.org>,
        "linux-kernel" <linux-kernel@vger.kernel.org>
Subject: Re: [PATCH] ALSA: hda/realtek - Fix headset mic problem for a HP machine with alc671
In-Reply-To: <tencent_080B040F1CE2D7D83D6FD0C8@qq.com>
References: <tencent_080B040F1CE2D7D83D6FD0C8@qq.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
X-Spam-Status: No, score=-4.4 required=5.0 tests=BAYES_00,DKIM_SIGNED,
        DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_MED,SPF_HELO_NONE,
        SPF_PASS,T_SCC_BODY_TEXT_LINE autolearn=ham autolearn_force=no
        version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Fri, 11 Mar 2022 02:20:42 +0100,
huangwenhui wrote:
> 
> Hi  Takashi,
> 
> if adjusting the mixer element or replugging the headset, the headphone would
> be unmuted.
> But most users hope that the default state is unmuted.
> Should this unconditional unmute be required?

It's the standard behavior for most of ALSA drivers.

The initial mute state is rather controlled via alsactl, restoring the
previous state.  Also, the sound server like PulseAudio or pipewire
does unmute automatically.  If this doesn't work as expected, that's a
more problem to diagnose.


Takashi

> 
> Thanks.
> 
> ------------------ Original ------------------
> From:  "Takashi Iwai"<tiwai@suse.de>;
> Date:  Thu, Mar 10, 2022 10:03 PM
> To:  "黄文辉"<huangwenhuia@uniontech.com>;
> Cc:  "perex"<perex@perex.cz>; "tiwai"<tiwai@suse.com>; "jeremy.szu"
> <jeremy.szu@canonical.com>; "hui.wang"<hui.wang@canonical.com>; "wse"
> <wse@tuxedocomputers.com>; "cam"<cam@neo-zeon.de>; "kailang"
> <kailang@realtek.com>; "tanureal"<tanureal@opensource.cirrus.com>; "sami"
> <sami@loone.fi>; "alsa-devel"<alsa-devel@alsa-project.org>; "linux-kernel"
> <linux-kernel@vger.kernel.org>;
> Subject:  Re: [PATCH] ALSA: hda/realtek - Fix headset mic problem for a HP
> machine with alc671
>  
> On Thu, 10 Mar 2022 14:58:36 +0100,
> huangwenhui wrote:
> >
> > Hi  Takashi,
> >
> > Thank you for your reply.
> >
> > When booting with plugged headset, the headphone will be muted.
> 
> The muted state is the default behavior.  Wouldn't it be unmuted if
> you adjust the corresponding mixer element?
> 
> Takashi
> 
> >
> > Thanks.
> > 
> > ------------------ Original ------------------
> > From:  "Takashi Iwai"<tiwai@suse.de>;
> > Date:  Thu, Mar 10, 2022 09:29 PM
> > To:  "huangwenhui"<huangwenhuia@uniontech.com>;
> > Cc:  "perex"<perex@perex.cz>; "tiwai"<tiwai@suse.com>; "jeremy.szu"
> > <jeremy.szu@canonical.com>; "hui.wang"<hui.wang@canonical.com>; "wse"
> > <wse@tuxedocomputers.com>; "cam"<cam@neo-zeon.de>; "kailang"
> > <kailang@realtek.com>; "tanureal"<tanureal@opensource.cirrus.com>; "sami"
> > <sami@loone.fi>; "alsa-devel"<alsa-devel@alsa-project.org>; "linux-kernel"
> > <linux-kernel@vger.kernel.org>;
> > Subject:  Re: [PATCH] ALSA: hda/realtek - Fix headset mic problem for a HP
> > machine with alc671
> > 
> > On Thu, 10 Mar 2022 14:03:01 +0100,
> > huangwenhui wrote:
> > >
> > > On a HP 288 Pro G8, the front Mic could not be detected.
> > >
> > > Signed-off-by: huangwenhui <huangwenhuia@uniontech.com>
> >
> > Thanks for the patch.  Most of the changes look OK, but one thing I
> > still don't get:
> >
> > > + case HDA_FIXUP_ACT_INIT:
> > > + alc_write_coef_idx(codec, 0x19, 0xa054);
> > > + msleep(80);
> > > + snd_hda_codec_write(codec, hp_pin, 0,
> > > +     AC_VERB_SET_AMP_GAIN_MUTE, AMP_OUT_UNMUTE);
> >
> > Why this unconditional unmute is required for fixing the mic problem?
> >
> > Takashi
> >
> >
> 
> 
