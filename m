Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id E7EF758DC6E
	for <lists+linux-kernel@lfdr.de>; Tue,  9 Aug 2022 18:49:41 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S244907AbiHIQti (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Tue, 9 Aug 2022 12:49:38 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:33686 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S243303AbiHIQte (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Tue, 9 Aug 2022 12:49:34 -0400
Received: from ams.source.kernel.org (ams.source.kernel.org [IPv6:2604:1380:4601:e00::1])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 236D422528
        for <linux-kernel@vger.kernel.org>; Tue,  9 Aug 2022 09:49:34 -0700 (PDT)
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by ams.source.kernel.org (Postfix) with ESMTPS id CF40DB81630
        for <linux-kernel@vger.kernel.org>; Tue,  9 Aug 2022 16:49:32 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 7762FC433D6;
        Tue,  9 Aug 2022 16:49:31 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=k20201202; t=1660063771;
        bh=vmvrp06z/9E5ewruB9hgQbojabCvvAtIPWajE3UadeQ=;
        h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
        b=t6I4JlIFvjmcpGC/JHRBo44PJ98DBijbD1LNg2Lxhc2dEh+ewO/2gHhfRBpY+mwef
         Ezn2QdoavHmJ2ClgL6pTJdVpyCemhpD0Uhjgsap7HhuXj1ufnvvBA5ruxmRNIiA5Cn
         axNCCEHzXR5h1rF/Cx76nvVV1TwuONnumgYLjOY8FIe3pBFjapwsaobMq8k8SM1/Eq
         m0vrO0qAATlK62IFwTuguL114cVlr5jN0IeiI/uIQxBNydTgVxvDMJqyxNVJmFdgdv
         MjjVHNC/Vx45kE/2mHI81wEjCJHcOW1jtDsF39ltDyxK7ugW1NRPBaYNPF3OA2Tcuq
         kaPWRPYTOxqXw==
Received: from sofa.misterjones.org ([185.219.108.64] helo=why.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.95)
        (envelope-from <maz@kernel.org>)
        id 1oLSQ5-001xDr-6g;
        Tue, 09 Aug 2022 17:49:29 +0100
Date:   Tue, 09 Aug 2022 17:49:28 +0100
Message-ID: <87v8r1uztz.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     Evgenii Stepanov <eugenis@google.com>
Cc:     Catalin Marinas <catalin.marinas@arm.com>,
        Will Deacon <will@kernel.org>,
        Peter Collingbourne <pcc@google.com>,
        Vincenzo Frascino <vincenzo.frascino@arm.com>,
        Andrey Konovalov <andreyknvl@gmail.com>,
        Mark Brown <broonie@kernel.org>,
        Linux ARM <linux-arm-kernel@lists.infradead.org>,
        LKML <linux-kernel@vger.kernel.org>
Subject: Re: [PATCH] mte: Follow arm64.nomte override in MMU setup.
In-Reply-To: <CAFKCwrjVaOdrGktxVHLCDPyJSRjZ0B3FHTGsb3PXMULL=dw9rA@mail.gmail.com>
References: <20220805214734.1937451-1-eugenis@google.com>
        <875yj1x0k0.wl-maz@kernel.org>
        <CAFKCwrjVaOdrGktxVHLCDPyJSRjZ0B3FHTGsb3PXMULL=dw9rA@mail.gmail.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/27.1
 (x86_64-pc-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: eugenis@google.com, catalin.marinas@arm.com, will@kernel.org, pcc@google.com, vincenzo.frascino@arm.com, andreyknvl@gmail.com, broonie@kernel.org, linux-arm-kernel@lists.infradead.org, linux-kernel@vger.kernel.org
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
X-Spam-Status: No, score=-7.7 required=5.0 tests=BAYES_00,DKIMWL_WL_HIGH,
        DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_HI,
        SPF_HELO_NONE,SPF_PASS,T_SCC_BODY_TEXT_LINE autolearn=ham
        autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Tue, 09 Aug 2022 17:41:28 +0100,
Evgenii Stepanov <eugenis@google.com> wrote:
> 
> On Tue, Aug 9, 2022 at 1:50 AM Marc Zyngier <maz@kernel.org> wrote:
> > How comes such memory is being used? How comes it is in the linear
> > map?
> >
> > arm64.nomte is affecting the use of MTE feature on the platform. It
> > doesn't guard the use of a MTE carve-out, and doesn't allow it to be
> > used in any shape or form.
> >
> > To use this memory, you should remove the MTE configuration
> > altogether, as you cannot infer what the CPU is doing with it.
> 
> This can be used to enable MTE in TZ but not in the NS memory.

In which case what is the tag memory doing in the linear map?
Shouldn't it be marked as reserved, not mapped, and in general
completely ignored by the NS OS?

	M.

-- 
Without deviation from the norm, progress is not possible.
