Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 22EB24C2959
	for <lists+linux-kernel@lfdr.de>; Thu, 24 Feb 2022 11:28:19 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S233397AbiBXK0o (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Thu, 24 Feb 2022 05:26:44 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:34236 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S232354AbiBXK0m (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 24 Feb 2022 05:26:42 -0500
Received: from ams.source.kernel.org (ams.source.kernel.org [145.40.68.75])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id AED7A28B63E;
        Thu, 24 Feb 2022 02:26:07 -0800 (PST)
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by ams.source.kernel.org (Postfix) with ESMTPS id 92E04B8251F;
        Thu, 24 Feb 2022 10:26:06 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 3D17CC340E9;
        Thu, 24 Feb 2022 10:26:05 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=k20201202; t=1645698365;
        bh=/Muanj6F0P6ufCvutPrTXUCoq7899wGHsyaNdapLJ/c=;
        h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
        b=UB/f4wtXoXjeoOoprgTWU0+Q6hMuQJevM8Z3J7ySKbAtBir7Co9Cpbd6+z4CU2x6d
         oTXgr0yanU2PEyYMuB0kJRr8NUezbnfVe6Fz9S8iXAW9gQCPdu7cfm8+jrVWEjid5h
         FEoN5NIWk2LKmpOOy+vjnSrHFsdXugIUXbpNZ6TXOqJmMJ/R2llShw3tZdubbhOdJp
         aOXdnKiHiDbQaNo73O23C1os+p7lL1KdVwR1K8tSha5qwbZNf0QzsBlwvWUk1R8G86
         7sUTloCGrnAez6efRTZknVkxRQlAfplKjta/QV1y1mTBDttnnAgxM3HB/cRx/4Cw6g
         i1d3jDcOwbm/Q==
Received: from sofa.misterjones.org ([185.219.108.64] helo=why.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.94.2)
        (envelope-from <maz@kernel.org>)
        id 1nNBJy-00A9Ij-Pn; Thu, 24 Feb 2022 10:26:02 +0000
Date:   Thu, 24 Feb 2022 10:26:02 +0000
Message-ID: <874k4o4l39.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     Elliot Berman <quic_eberman@quicinc.com>,
        Mark Rutland <mark.rutland@arm.com>
Cc:     Bjorn Andersson <bjorn.andersson@linaro.org>,
        linux-kernel@vger.kernel.org, Trilok Soni <quic_tsoni@quicinc.com>,
        Murali Nalajala <quic_mnalajala@quicinc.com>,
        Srivatsa Vaddagiri <quic_svaddagiri@quicinc.com>,
        Carl van Schaik <quic_cvanscha@quicinc.com>,
        Andy Gross <agross@kernel.org>, linux-arm-msm@vger.kernel.org,
        linux-arm-kernel@lists.infradead.org,
        Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>,
        Sudeep Holla <sudeep.holla@arm.com>
Subject: Re: [PATCH 03/11] arm64: gunyah: Add Gunyah hypercalls ABI
In-Reply-To: <YhdZen7MwdAIJMsu@lakrids>
References: <20220223233729.1571114-1-quic_eberman@quicinc.com>
        <20220223233729.1571114-4-quic_eberman@quicinc.com>
        <YhdZen7MwdAIJMsu@lakrids>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/27.1
 (x86_64-pc-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: quic_eberman@quicinc.com, mark.rutland@arm.com, bjorn.andersson@linaro.org, linux-kernel@vger.kernel.org, quic_tsoni@quicinc.com, quic_mnalajala@quicinc.com, quic_svaddagiri@quicinc.com, quic_cvanscha@quicinc.com, agross@kernel.org, linux-arm-msm@vger.kernel.org, linux-arm-kernel@lists.infradead.org, lorenzo.pieralisi@arm.com, sudeep.holla@arm.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
X-Spam-Status: No, score=-7.1 required=5.0 tests=BAYES_00,DKIMWL_WL_HIGH,
        DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_HI,
        SPF_HELO_NONE,SPF_PASS,T_SCC_BODY_TEXT_LINE autolearn=ham
        autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Thanks Mark for roping me in.

On Thu, 24 Feb 2022 10:10:02 +0000,
Mark Rutland <mark.rutland@arm.com> wrote:
> 
> Hi,
> 
> As a general thing, this is the *only* patch from this series which has
> been Cc'd to linux-arm-kernel, which makes it practically impossible to
> understand the context for this, which is somewhat frustrating.
> 
> Looking on lore.kernel.org I see that the entire series was Cc'd to
> linux-arm-msm, but most people don't subscribe to that list. If you send
> one patch in a series to a list, please send the *entire* series there.
> 
> On Wed, Feb 23, 2022 at 03:37:21PM -0800, Elliot Berman wrote:
> > Add initial support to perform Gunyah hypercalls. The arm64 ABI for
> > Gunyah hypercalls generally follows the AAPCS64, and can be summarized:
> >  - Function identifier is passed through the imm operand
> >  - [r0,r7] are parameter and result registers
> >  - [r8-r18] are temporary and saved by the caller (VM)
> >  - [r19-r31] are preserved and saved by the hypervisor
> >
> > The preprocessor macors for creating the necessary HVC instruction
> > roughly follows the SMCCC 1.1 implementation in
> > include/linux/arm-smccc.h.
> 
> I've added the SMCCC maintainers (myself, Lorenzo, and SUdeep) to Cc,
> and also Marc who was involvedi n prior discussions in this area. Please
> Cc us on any future patches adding HVC or SMCC interfaces (SMCCC or
> otherwise).

In general, please Cc all the interested parties with the whole
series. Random patches randomly cc'd out of context are pretty useless
and only lead to them being ignored.

> 
> We've previously said NO to any new hypercall mechanisms which do not
> follow SMCCC. There is no reason to fragment this space further; please
> use SMCCC (which your hypervisor must already implement in part if it
> exposes PSCI to a guest).
> 
> NAK to this non-SMCCC interface.

Agreed. We pushed back on that for Hyper-V, and I don't see a reason
for changing tack on that.

The calling convention exists for a reason: portability. If this
hypervisor is to be "independent of any high-level OS kernel" (as it
is being advertised), then it must already implement SMCCC.

What is the issue with properly supporting SMCCC for all interactions
with the hypervisor and not reinventing a square wheel?

Thanks,

	M.

-- 
Without deviation from the norm, progress is not possible.
